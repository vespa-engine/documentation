---
# Copyright Vespa.ai. All rights reserved.
title: Provide Custom Overrides
applies_to: enterprise
---

<p>
While services.xml defines the Vespa application specification, it abstracts away the underlying Kubernetes infrastructure.
Advanced users often need to configure Kubernetes-specific settings for the Vespa application Pods to integrate Vespa within their broader platform ecosystem.
</p>

<p>
The Pod Template mechanism allows you to inject custom configurations into the Vespa application pods created by the ConfigServer.
</p>

<p>
Common use cases for overriding the default pod configuration include:

<ul>
    <li><b>Sidecar Injection</b>:  Running auxiliary containers alongside Vespa for logging (e.g., Fluent Bit), monitoring (e.g., Datadog, Prometheus exporters), or service mesh proxies (e.g., Envoy, Istio). </li>
    <li><b>Scheduling Constraints</b>: Using nodeSelector, affinity, or tolerations to pin Vespa pods to specific hardware (e.g., high-memory nodes, specific availability zones) or isolate them from other workloads.</li>
    <li><b>Metadata Management</b>: Adding custom Labels or Annotations for cost allocation, team ownership, or integration with external inventory tools.</li>
    <li><b>Security & Config</b>: Mounting Kubernetes Secrets or ConfigMaps that contain credentials or environment configurations required by custom sidecars.</li>
</ul>

<h2>Configure Custom Overrides</h2>

<p>
Overrides are defined in the <code>VespaSet</code> Custom Resource under <code>spec.application.podTemplate</code> and <code>spec.configServer.podTemplate</code>. This field accepts a standard Kubernetes PodTemplateSpec.
</p>

<p>
The Operator and ConfigServer treat this template as an overlay. When creating a ConfigServer or Application Pod, the base template of the main <code>vespa</code> container is merged with your custom overlay.
</p>

<p>
Vespa on Kubernetes enforces a <code>Add-Only</code> merge strategy. One cannot remove or downgrade core <code>vespa</code> container settings, but only augment them.
</p>

<table class="table">
    <thead>
    <tr>
        <th>Category</th>
        <th>Allowed Actions</th>
        <th>Restricted Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><strong>Containers</strong></td>
        <td>
            <ul>
                <li>Add new sidecar containers.</li>
                <li>Add env vars/mounts to main container.</li>
            </ul>
        </td>
        <td>
            <ul>
                <li>Cannot change main container image, command, or args.</li>
                <li>Cannot override main container CPU/Memory resources (these are locked to <code>services.xml</code>).</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td><strong>Volumes</strong></td>
        <td>
            <ul>
                <li>Add new Volumes (ConfigMap, Secret, EmptyDir).</li>
            </ul>
        </td>
        <td>
            <ul>
                <li>Cannot modify operator-reserved volumes (e.g., <code>/data</code>).</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td><strong>Metadata</strong></td>
        <td>
            <ul>
                <li>Add new Labels and Annotations.</li>
            </ul>
        </td>
        <td>
            <ul>
                <li>Cannot overwrite operator-created labels and annotations</li>
            </ul>
        </td>
    </tr>
    </tbody>
</table>
<h2>Examples</h2>

<h3>Example 1: Injecting a Logging Sidecar</h3>

<p>
This example adds a Fluent Bit sidecar to ship logs to a central system. It defines the sidecar container and mounts a shared volume that the Vespa container also writes to.
</p>

<pre>
apiVersion: k8s.ai.vespa/v1
kind: VespaSet
metadata:
  name: my-vespa-cluster
spec:
  application:
    image: vespaengine/vespa:8.200.15
    # Define the Custom Overlay
    podTemplate:
      spec:
        containers:
          # 1. Define the Sidecar
          - name: fluent-bit
            image: fluent/fluent-bit:1.9
            volumeMounts:
              - name: vespa-logs
                mountPath: /opt/vespa/logs/vespa
        # 2. Define the Shared Volume
        volumes:
          - name: vespa-logs
            emptyDir: {}
</pre>

<h3>Example 2: Pinning Pods to Specific Nodes</h3>

<p>
This example uses a nodeSelector to ensure Vespa pods only run on nodes labeled with workload=high-performance.
</p>

<pre>
apiVersion: k8s.ai.vespa/v1
kind: VespaSet
metadata:
  name: prod-vespa
spec:
  application:
    podTemplate:
      spec:
        # Schedule only on nodes with label 'workload: high-performance'
        nodeSelector:
          workload: high-performance
        # Tolerate the 'dedicated' taint if those nodes are tainted
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "search-team"
            effect: "NoSchedule"
</pre>

<h3>Example 3: Adding Cost Allocation Labels</h3>

<p>
This example adds custom labels that will appear on every tenant pod, enabling cost tracking by team.
</p>

<pre>
apiVersion: k8s.ai.vespa/v1
kind: VespaSet
metadata:
  name: shared-vespa
spec:
  application:
    podTemplate:
      metadata:
        labels:
          cost-center: "engineering-search"
          owner: "team-alpha"
        annotations:
          # Example annotation for an external monitoring system
          monitoring.datadoghq.com/enabled: "true"
</pre>