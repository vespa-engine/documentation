---
# Copyright Yahoo. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "Vespa 8 Release Notes"
redirect_from:
- /documentation/vespa8-release-notes.html
---

{% include note.html content="This is work in progress, Vespa 8 has not been released yet."%}
<p>
  This document describes the changes between Vespa major versions 7 and 8.
  As documented in <a href="https://vespa.ai/releases#versions">Vespa versions</a>,
  new functionality is introduced in minor versions, while major versions are used to mark
  breaking compatibility. As Vespa 8 does not introduce new functionality,
  it is as safe and mature as the versions of Vespa 7 preceding it.
  Upon release of Vespa 8, no further releases will be made of Vespa 7.
</p>



<h2 id="compatibility-overview">Overview</h2>
<p>
  Usage of deprecated Java APIs produce warnings during compilation, while <em>deployment warnings</em>
  are produced for application package deprecations and most changes to the container runtime environment.
  In hosted Vespa or Vespa Cloud, deployment warnings are shown in the application's console view.
  However, for other types of changes, there is no way to emit deprecation warnings,
  so these are only described in this document and other Vespa documentation.
</p>

<p>
  The compatibility breaking changes in Vespa 8 can be split into these main categories:
</p>
<ul>
  <li><a href="#changed-defaults">Changes to default behaviour</a></li>
  <li><a href="#application-package-changes">Application package structure and settings</a> -
    deprecated settings and constructs in e.g. <em>schemas</em> and <em>services.xml</em> are removed.</li>
  <li><a href="#java-api-changes">Java APIs</a> -
    deprecated APIs are removed or revoked from Vespa's
    <a href="https://javadoc.io/doc/com.yahoo.vespa/annotations/latest/com/yahoo/api/annotations/PublicApi.html">public API</a> surface.</li>
  <li><a href="#container-runtime">Container runtime environment</a> -
    incompatible changes to the Java build and runtime environments.</li>
  <li><a href="#removed-http-api-parameters">HTTP API changes</a></li>
  <li><a href="#removed-command-line-tools">Removed command line tools</a></li>
  <li><a href="#removed-metrics">Removed metrics</a></li>
  <li><a href="#document-selection-exact-type-matching">Changes to the document selection language</a></li>
  <li><a href="#security">Security related changes</a></li>
  <li><a href="#operating-system">Operating system support</a></li>
  <li><a href="#other-changes">Other changes</a>, not covered by any of the above categories.</li></ul>


<p>
In order to be compatible with Vespa 8, application owners must:
<ul>
  <li>Review the list of <a href="#changed-defaults">changes to defaults</a> and add the necessary options
    if you want to preserve behavior from Vespa 7.</li>
  <li>Make sure there are no deprecation warnings when compiling against Vespa 7.</li>
  <li>Review the <a href="#application-package-changes">application package changes</a> and make sure there
    are no deployment warnings when deploying on Vespa 7.</li>
  <li>Review the list of <a href="#removed-http-api-parameters">HTTP API changes</a> and update
    any clients of the application.</li>
  <li>Review the remaining sections of this document, and update the application and its environment accordingly.</li>
</ul>

<p>
  The sections below describe the changes from Vespa 7 to Vespa 8 in more detail.
</p>


<!-- ToDo: something on the xml/page presentation.format from query-api-reference.html -->

<!-- ToDo: searchdefinitions and search is deprecated - note here -->


<h2 id="changed-defaults">Changed defaults</h2>
<p>
The following defaults have changed:
</p>
<table class="table">
  <tr>
    <th>Change</th>
    <th>Configuration required to avoid change on Vespa 8</th>
  </tr>

  <tr>
    <td>
      The default <a href="reference/simple-query-language-reference.html">simple query language</a> (for end users)
      is changed from <code>all</code> to <code>weakAnd</code>.
    </td>
    <td>
      Explicitly pass <a href="reference/query-api-reference.html#model.type">model.type</a>=all in queries
      or set this parameter in the relevant <a href="query-profiles.html">query profiles</a>.
    </td>
  </tr>

  <tr>
    <td>
      The default grammar in <a href="reference/query-language-reference.html#userinput">YQL userInput</a>
      is changed from <code>all</code> to <code>weakAnd</code>.
    </td>
    <td>
      Prefix <code>userInput</code> in YQL by <code>{grammar: "all"}</code>.
    </td>
  </tr>

  <tr>
    <td>
      The value of the services.xml
      <a href="legacy-v7-json-rendering.html#geo-position-rendering">legacy flag v7-geo-positions</a>
      changes from true to false.
    </td>
    <td>
      Add to services.xml:
      <code>
        &lt;legacy&gt; &lt;v7-geo-positions&gt;true&lt;/v7-geo-positions&gt; &lt;/legacy&gt;
      </code>
    </td>
  </tr>

  <tr>
    <td>
      Fields of type <code>map</code> may
      <a href="legacy-v7-json-rendering.html#map-rendering">change
      JSON rendering</a> in search results.
    </td>
    <td>
      Add overrides in your query profile(s) for the <code>render.json.jsonMaps</code> parameter.
    </td>
  </tr>

  <tr>
    <td>
      Fields of type <code>weightedset</code> has
      <a href="legacy-v7-json-rendering.html#wset-rendering">changed
      JSON rendering</a> in search results.
    </td>
    <td>
      Add overrides in your query profile(s) for the <code>render.json.jsonWsets</code> parameter.
    </td>
  </tr>

  <tr>
    <td>
      Fields of type <code>raw</code> are now presented as a base64
      encoded string in summary, the same way as in json feed format.
      Earlier, you needed to add <code>raw-as-base64-in-summary</code>
      in your schema file to get this behavior.
    </td>
    <td>
      If you have fields of type "raw" and you must have the old
      summary behavior for them in search results, add the line
      <br><code>raw-as-base64-in-summary : false</code><br>
      in your schema definition.
    </td>
  </tr>

  <tr>
    <td>
      The default tensor format in responses has changed from 'long' to 'short':
      Tensors in query results, document API responses, and stateless model evaluation
      are rendered in the short form appropriate for their type
      (if any), documented <a href="reference/document-json-format.html#tensor">here</a>.
    </td>
    <td>
      <p><b>Queries</b>: Pass <a href="reference/query-api-reference.html#presentation.format.tensors">presentation.format.tensors</a>=long
      in queries, or set it parameter in the relevant <a href="query-profiles.html">query profiles</a>.</p>

      <p><b>Document/v1</b>: Pass the parameter <code>format.tensors=long</code> in requests.</p>

      <p><b>Stateless model evaluation</b>: Pass the parameter <code>format.tensors=long</code> in requests.</p>
    </td>
  </tr>

  <tr>
    <td>
      The default fieldset when getting or visiting documents is now
      <code>[document]</code> in all cases, meaning you only get those
      fields that are declared in the "document" block of the schema
      (generated fields are not included).
      This was already the default for the <code>/document/v1</code> API
      when fetching or visiting documents of a single known document type.
      Now it is also the default when visiting at the root level,
      for the command line tools <code>vespa-visit</code> and
      <code>vespa-get</code>, and if you use the programmatic
      <code>documentapi</code> from java to fetch documents.
    </td>
    <td>
      In most cases there is no difference between <code>[all]</code>
      and <code>[document]</code> fieldsets - so no action is needed.
      If the old behavior is needed you can:
      <ul>
        <li>
	  For the command line tools, specify the fieldset as
	  <code>-l "[all]"</code> to include generated fields.
        </li>
        <li>
	  For <code>/document/v1</code> specify <code>[all]</code>
	  as the value for the <code>fieldSet</code> parameter.
        </li>
        <li>
          If using <code>documentapi</code> from java, add the line
          <br><code>params.setFieldSet("[all]");</code><br>
          to modify your <code>VisitorParameters</code> value , or
          <br><code>params = params.withFieldSet("[all]");</code><br>
          to modify your <code>DocumentOperationParameters</code> value.
        </li>
      </ul>
      If you run document processors to generate fields and want
      those returned, it may be more useful to declare a fieldset
      with just those fields you actually want as output instead.
    </td>
  </tr>
  <tr>
    <td>
      Vespa will now limit the number of groups and document summaries in
      <a href="https://docs.vespa.ai/en/grouping.html">grouping query results</a> by default.
      The first two limits behave like implicit <code>max(&lt;limit&gt;)</code> clauses that are inserted into all levels of a grouping query.
      Any explicit <code>max(&lt;limit&gt;)</code> clause in grouping queries take precedence over the specified limits.
      There is also a third limit that restricts the combined number of groups and summaries.
      Any query that can produce a result exceeding this limit is preemptively failed before execution.
    </td>
    <td>
      See <a href="https://docs.vespa.ai/en/reference/grouping-syntax.html">documentation</a> on <code>grouping.defaultMaxHits</code>,
      <code>grouping.defaultMaxGroups</code> and <code>grouping.globalMaxGroups</code> for details.
    </td>
  </tr>

</table>



<h2 id="application-package-changes">Application package changes</h2>


<h3 id="removed-settings-from-schemas">Removed settings from schemas</h3>
<p>
  The following settings are removed from
  <a href="reference/schema-reference.html">schema</a>:
</p>
<table class="table">
  <thead>
  <tr>
    <th>Name</th><th>Replacement</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>attribute: huge</td>
    <td>None. Setting <em>huge</em> on an attribute doesn't have any effect,
        the code is rewritten to support it by default.</td>
  </tr>
  <tr>
    <td><a href="reference/schema-reference.html#compression">compression</a></td>
    <td>
      <p id="compression">
      None. Document compression is not needed, as compression is always enabled.
      Support for setting this is deprecated and might be removed in Vespa 8.
      </p>
    </td>
  </tr>
  <tr>
    <td>body (inside a field definition)</td>
    <td>
      <p id="body">None. Deprecated since before Vespa 7, had no effect in Vespa 7.</p>
    </td>
  </tr>
  <tr>
    <td>header (inside a field definition)</td>
    <td><p id="header">None. Deprecated since before Vespa 7, had no effect in Vespa 7.</p></td>
  </tr>
  <tr>
    <td>field type weightedset&lt;float&gt;</td>
    <td>
      Because floating-point types are inherently imprecise they are badly
      suited as keys in maps and sets.  If you feel the need for such data
      consider using something like:
      <pre class="code">
             struct weightedfloat {
                 field value type float {}
                 field weight type int {}
             }
             field myfield type array&lt;weightedfloat&gt; {
                 ...
          </pre>
    </td>
  </tr>
  <tr>
    <td>field type map&lt;float,anything&gt;</td>
    <td>Using "float" as the key in a map is no longer supported, see <code>weightedset&lt;float&gt;</code> above.</td>
  </tr>
  <tr>
    <td>field type weightedset&lt;double&gt;</td>
    <td>Using "double" as the key in a set is no longer supported, see <code>weightedset&lt;float&gt;</code> above.</td>
  </tr>
  <tr>
    <td>field type map&lt;double,anything&gt;</td>
    <td>Using "double" as the key in a map is no longer supported, see <code>weightedset&lt;float&gt;</code> above.</td>
  </tr>
  <tr>
    <td>field type weightedset&lt;uri&gt;</td>
    <td>Using complex types as the key in a set is no longer supported, see <code>weightedset&lt;float&gt;</code> above.</td>
  </tr>
  <tr>
    <td>field type map&lt;uri,anything&gt;</td>
    <td>Using complex types as the key in a map is no longer supported, see <code>weightedset&lt;float&gt;</code> above.</td>
  </tr>
  <tr>
    <td>Old syntax for array types like "string[]"</td>
    <td>Write as <code>array&lt;string&gt;</code> instead.</td>
  </tr>
  <tr>
    <td>Rank functions must have different names in a rank-profile</td>
    <td>Only the last of two functions with the same name would be used.
        Remove or rename the first one.</td>
  </tr>
  <tr>
    <td>Conflicting sorting settings are now rejected</td>
    <td>Only keep the last of the conflicting settings.</td>
  </tr>
  <tr>
    <td>A summary-field may only be added once in a document-summary block</td>
    <td>Remove duplicates.</td>
  </tr>
  <tr>
    <td>Schema and document should have the same name</td>
    <td>Change name of the schema so it is equal to the contained document.</td>
  </tr>
  </tbody>
</table>


<h3 id="tensorflow-import">TensorFlow import</h3>
<p>
  Vespa 8 will remove support for direct import of <a href="https://docs.vespa.ai/en/tensorflow.html">TensorFlow models</a>.
  <a href="https://onnx.ai/">ONNX</a> is now the preferred ML model format, and works both for
  <a href="https://docs.vespa.ai/en/onnx.html">ranking</a> as well as
  <a href="https://docs.vespa.ai/en/stateless-model-evaluation.html">stateless model evaluation</a>.
  ONNX contains tools to convert models from TensorFlow to ONNX, but Vespa will no longer provide this.
</p>


<h3 id="changed-semantics-inservices-xml">Changed semantics in services.xml</h3>
<p>
  The following deprecated elements and attributes in services.xml have new semantics:
</p>
<table class="table">
  <thead>
  <tr>
    <th>Name</th><th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td>&lt;nodes&gt;&lt;redundancy&gt;</td>
    <td>It is now an error to configure a number of nodes (per group) that is
      smaller than the configured redundancy.  It used to generate an
      application-level warning, with the redundancy implicitly reduced.
      Remove any &lt;nodes&gt; override in the non-prod environments, as the
      node count is automatically adjusted.</td>
  </tr>
  </tbody>
</table>


<h3 id="removed-constructs-from-services-xml">Removed constructs from services.xml</h3>
<p>
  The following elements and attributes are removed from services.xml:
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parent element</th><th>Removed construct</th><th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td rowspan="2">&lt;admin&gt;</td>
    <td>&lt;filedistribution&gt;</td>
    <td>Configuring up/download rates is not supported</td>
  </tr>
  <tr>
    <td>&lt;configserver&gt;</td>
    <td>Use <a href="reference/services-admin.html#configservers">configservers</a> element instead</td>
  </tr>
  <tr>
    <td rowspan="2">&lt;config&gt;</td>
    <td><em>namespace</em> attribute</td>
    <td>The namespace must be included in the <em>name</em> attribute.</td>
  </tr>
  <tr>
    <td>&lt;myArray <em>operation="append"&gt;</em> syntax</td>
    <td>Previously used to append items to config arrays. Use
      <a href="reference/config-files.html#configuring-arrays">item</a> instead.</td>
  </tr>
  <tr>
    <td rowspan="4">&lt;container&gt;</td>
    <td><em>jetty</em> attribute</td>
    <td>Removed, had no effect on Vespa 7.</td>
  </tr>
  <tr>
    <td>&lt;nodes&gt; jvm attributes</td>
    <td>JVM attributes <em>jvmargs, allocated-memory, jvm-options, jvm-gc-options</em>
      renamed and moved to <a href="reference/services-container.html#jvm">
        JVM</a> subelement</td>
  </tr>
  <tr>
    <td>&lt;client&gt;</td>
    <td>Previously used for setting up client providers.
      Use a <a href="jdisc/developing-request-handlers.html">request handler</a> instead.</td>
  </tr>
  <tr>
    <td>&lt;handler&gt;&lt;clientBinding&gt;</td>
    <td>Client bindings are no longer supported.
  </tr>
  <tr>
    <td rowspan="3">&lt;content&gt;</td>
    <td>&lt;dispatch&gt;</td>
    <td>Removed due to removal of <em>vespa-dispatch-bin</em>,
      <a href="#vespa-dispatch-bin-process-is-removed">details.</a></td>
  </tr>
  <tr>
    <td>&lt;tuning&gt;&lt;dispatch&gt;&lt;min-group-coverage&gt;</td>
    <td>Use <a href="reference/services-content.html#min-active-docs-coverage">min-active-docs-coverage</a> instead.</td>
  </tr>
  <tr>
    <td>&lt;tuning&gt;&lt;dispatch&gt;&lt;use-local-node&gt;</td>
    <td>Ignored, the local node will automatically be preferred when appropriate.</td>
  </tr>
  <tr>
    <td rowspan="3">&lt;services&gt; (root)</td>
    <td>&lt;jdisc&gt;</td>
    <td>Use <a href="reference/services-container.html">container</a> instead.
  </tr>
  <tr>
    <td>&lt;service&gt;</td>
    <td>Running generic services is no longer supported.</td>
  </tr>
  <tr>
    <td>&lt;clients&gt;</td>
    <td>Client load types are deprecated and ignored.</td>
  </tr>
  </tbody>
</table>


<h3 id="application-folder"><em>application/</em> folder support removed</h3>
<p>
  Application package content (<em>services.xml</em>, the <em>schemas/</em>
  folder, etc.) is supposed to be put at the root level in the application
  zip, such that the unzipped application package has <em>./services.xml</em>,
  etc.
</p>
<p>
  But it used to be that the application package content could be placed inside
  an <em>application</em> directory.  This support is removed with Vespa 8.
</p>


<h3 id="searchdefinitions-folder"><em>searchdefinitions/</em> folder is deprecated</h3>
<p>
  Search definition schemas should now be placed in the <em>schemas/</em> folder. The old folder
  will still work on Vespa 8, but causes a deprecation warning upon deployment.
</p>



<h2 id="java-api-changes">Java API changes</h2>

<h3 id="removed-java-packages">Removed Java packages</h3>

<table class="table">
  <thead><tr><th>Package</th><th>Description</th></tr></thead>
  <tbody>
    <tr>
      <td><em>com.yahoo.docproc.util</em></td>
      <td>No longer <a href="https://javadoc.io/doc/com.yahoo.vespa/annotations/latest/com/yahoo/api/annotations/PublicApi.html">public API</a></td>
    </tr>
    <tr>
      <td><em>com.yahoo.jdisc.test</em></td>
      <td>No longer public API</td>
    </tr>
    <tr>
      <td><em>com.yahoo.log.event</em></td>
      <td>No longer public API</td>
    </tr>
    <tr>
      <td><em>com.yahoo.statistics</em></td>
      <td>Removed</td>
    </tr>
    <tr>
      <td><em>com.yahoo.vespa.curator</em></td>
      <td>No longer public API</td>
    </tr>
  </tbody>
</table>


<h3 id="removed-java-classes-and-methods">Removed Java Classes and methods</h3>

<p>
  Classes and methods that were marked as deprecated in Vespa 7 are removed.
  If deprecation warnings are emitted for Vespa API's when building the application,
  these must be fixed before migrating to Vespa 8. The sections below contain only the
  most notable changes.
</p>

<p>
  The following classes are no longer public API and have been moved to Vespa internal packages:
</p>
<table class="table">
  <thead><tr><th>Package</th><th>Class</th><th>Migration advice</th></tr></thead>
  <tbody>
  <tr>
    <td><em>com.yahoo.config.subscription</em></td>
    <td>All classes, except
      <a href="https://javadoc.io/doc/com.yahoo.vespa/config/latest/com/yahoo/config/subscription/ConfigGetter.html"><em>ConfigGetter</em></a></td>
    <td>Config should be <a href="configuring-components.html#use-config-in-code">injected</a>
      to your component class constructor.
    </td>
  </tr>
  <tr>
    <td rowspan="6"><em>com.yahoo.docproc</em></td>
    <td><em>DocprocExecutor</em></td>
    <td rowspan="2">For unit tests, follow the steps in the
      <a href="https://github.com/vespa-engine/sample-apps/blob/master/examples/document-processing/src/test/java/ai/vespa/example/album/ProductTypeRefinerDocProcTest.java">document-processing</a>
      sample app. If you need a <em>DocumentTypeManager</em> in production code, it can be directly
      <a href="jdisc/injecting-components.html">injected</a> to your component class constructor.
    </td>
  </tr>
  <tr>
    <td><em>DocprocService</em></td>
  </tr>
  <tr>
    <td><em>DocumentOperationWrapper</em></td>
    <td rowspan="4">No replacement - if needed, contact the Vespa team for advice.</td>
  </tr>
  <tr>
    <td><em>HandledProcessingException</em></td>
  </tr>
  <tr>
    <td><em>ProcessingEndpoint</em></td>
  </tr>
  <tr>
    <td><em>TransientFailureException</em></td>
  </tr>
  </tbody>
</table>

<p>
  The following methods are removed:
</p>
<table class="table">
  <thead><tr><th>Method</th><th>Migration advice</th></tr></thead>
  <tbody>
  <tr>
    <td><em>com.yahoo.documentapi.DocumentAccess.createDefault()</em></td>
    <td>Container components can have a <em>DocumentAccess</em> injected via their constructor.
      For use outside the container, e.g. in a custom command line tool, use the new method
      <em>createForNonContainer()</em>.</td>
  </tr>
  </tbody>
</table>


<h3 id="changed-java-apis">Breaking changes to Java APIs</h3>
<p>
  The Javadoc of the deprecated types/members should document the replacement API.
  The below list is not exhaustive - some smaller and trivial changes are not listed.
</p>
<table class="table">
  <thead><tr><th>Type(s)</th><th>Description</th></tr></thead>
  <tbody>
    <tr>
      <td><em>com.yahoo.processing</em></td>
      <td>Removed use of Guava's <em>ListenableFuture</em> in type signatures. Replacement uses <em>CompletableFuture</em>.</td>
    </tr>
    <tr>
      <td><em>com.yahoo.search.handler.HttpSearchResponse.waitableRender()</em></td>
      <td>Removed use of Guava's <em>ListenableFuture</em> in type signature. The method is replaced with <em>asyncRender()</em>.</td>
    </tr>
    <tr>
      <td><em>com.yahoo.jdisc.handler</em></td>
      <td>Removed use of Guava's <em>ListenableFuture</em> in type signatures. Replacement uses <em>CompletableFuture</em></td>
    </tr>
    <tr>
      <td><em>com.yahoo.searchlib.rankingexpression.rule</em></td>
      <td>Removed use of Guava collection types in type signatures.</td>
    </tr>
    <tr>
      <td><em>com.yahoo.search.rendering.JsonRenderer</em></td>
      <td>Removed use of Jackson types from class signature.</td>
    </tr>
    <tr>
      <td><em>com.yahoo.jdisc.Container</em></td>
      <td>Removed use of Guice types from class signature.</td>
    </tr>
    <tr>
      <td><em>com.yahoo.vdslib.VisitorStatistics</em></td>
      <td>Removed all <em>set/getSecondPass</em>-related methods.</td>
    </tr>
  </tbody>
</table>


<h3 id="built-in-xml-factories">Removed support for built-in XML factories</h3>
<p>
  The Jdisc container has historically supported injection of built-in providers for the following XML factories:
</p>

<ul>
  <li><em>javax.xml.datatype.DatatypeFactory</em></li>
  <li><em>javax.xml.parsers.DocumentBuilderFactory</em> and <em>SAXParserFactory</em></li>
  <li><em>javax.xml.stream.XMLEventFactory</em>, <em>XMLInputFactory</em> and <em>XMLOutputFactory</em></li>
  <li><em>javax.xml.transform.TransformerFactory</em></li>
  <li><em>javax.xml.validation.SchemaFactory</em></li>
  <li><em>javax.xml.xpath.XPathFactory</em></li>
</ul>

<p>
  These are now removed. Please check for more recent alternatives if you need this type of XML processing.
</p>


<h3 id="deprecated-java-apis">Deprecated Java APIs</h3>
<p>
  A few redundant APIs have been deprecated because they have replacements that
  provide the same, or better, functionality. We advise you switch to the
  replacement to reduce future maintenance cost.
</p>

<table class="table">
  <thead><tr><th>Type(s)</th><th>Replacement</th></tr></thead>
  <tbody>
  <tr>
    <td><em>com.yahoo.container.jdisc.LoggingRequestHandler</em></td>
    <td>Use <em>com.yahoo.container.jdisc.ThreadedHttpRequestHandler</em> instead.</td>
  </tr>
  <tr>
    <td><em>com.yahoo.log.LogLevel</em></td>
    <td>Use <em>java.util.logging.Level</em> instead.</td>
  </tr>
  </tbody>
</table>




<h2 id="container-runtime">Container Runtime Environment</h2>


<h3 id="jdk-version">JDK version</h3>
<p>
  Vespa 8 has upgraded the JDK version from 11 to 17. To ensure full compatibility, all container plugins
  should be rebuilt with JDK 17 before being deployed on Vespa 8.
</p>


<h3 id="provided-maven-artifacts">Changes to provided maven artifacts</h3>
<p>
  <a href="https://search.maven.org/artifact/com.google.guava/guava">Guava</a> has been upgraded from
  version 20.0 to TBD (estimated version: 27.1). If you are using APIs that have been removed from the
  library since version 20, your code must be updated. In most cases, it should be trivial to find
  replacement APIs in Java's standard library.
</p>

<p>
The following Maven artifacts are no longer provided runtime to user application plugins by the Jdisc container:
</p>
<table class="table">
  <thead><tr><th>Artifact</th><th>Notes</th></tr></thead>
  <tbody>
  <tr>
    <td><a href="https://search.maven.org/artifact/com.fasterxml.jackson.jaxrs/jackson-jaxrs-base"><em>com.fasterxml.jackson.jaxrs:jackson-jaxrs-base</em></a> </td>
    <td rowspan="2">JSON input/output handling for JAX-RS implementations, e.g. Jersey</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider"><em>com.fasterxml.jackson.jaxrs:jackson-jaxrs-json-provider</em></a> </td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/com.fasterxml.jackson.module/jackson-module-jaxb-annotations"><em>com.fasterxml.jackson.module:jackson-module-jaxb-annotations</em></a> </td>
    <td>Jackson data binding with JAXB annotations.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/com.google.code.findbugs/jsr305"><em>com.google.code.findbugs:jsr305</em></a></td>
    <td>Annotations in package <em>javax.annotation[.*]</em>, e.g. <em>Nullable</em> and <em>Nonnnull</em>.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/com.google.inject.extensions/guice-assistedinject"><em>com.google.inject.extensions:guice-assistedinject</em></a></td>
    <td>Guice extensions.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/com.google.inject.extensions/guice-multibindings"><em>com.google.inject.extensions:guice-multibindings</em></a></td>
    <td>Guice extensions.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/javax.annotation/javax.annotation-api"><em>javax.annotation:javax.annotation-api</em></a></td>
    <td>Annotations in package <em>javax.annotation[.*]</em>, e.g. <em>ManagedBean</em> and <em>Resource</em>.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/javax.validation/validation-api"><em>javax.validation:validation-api</em></a></td>
    <td>Javax bean validation, used by Jersey 2.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/javax.ws.rs/javax.ws.rs-api"><em>javax.ws.rs:javax.ws.rs-api</em></a></td>
    <td>JAX-RS API, used by Jersey 2.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.apache.felix/org.apache.felix.framework"><em>org.apache.felix:org.apache.felix.framework</em></a></td>
    <td>Felix OSGi framework.</td>
  </tr>
  <tr>
    <td><em>org.apache.felix:org.apache.felix.log</em></td>
    <td>Felix OSGi framework.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.apache.felix/org.apache.felix.main"><em>org.apache.felix:org.apache.felix.main</em></a></td>
    <td>Felix OSGi framework.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.bouncycastle/bcpkix-jdk15on"><em>org.bouncycastle:bcpkix-jdk15on</em></a></td>
    <td>Bouncy Castle crypto API.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.bouncycastle/bcprov-jdk15on"><em>org.bouncycastle:bcprov-jdk15on</em></a></td>
    <td>Bouncy Castle crypto provider.</td>
  </tr>
  <tr>
    <td><em>org.glassfish.*:*</em></td>
    <td>Jersey 2. All related artifacts are removed.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.json/json"><em>org.json:json</em></a></td>
    <td>See <a href="https://github.com/vespa-engine/vespa/issues/14762">vespa-engine/vespa#14762</a></td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.javassist/javassist"><em>org.javassist:javassist</em></a></td>
    <td>Bytecode manipulation, used by Jersey 2.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.jvnet.mimepull/mimepull"><em>org.jvnet.mimepull:mimepull</em></a></td>
    <td>MIME Streaming Extension, used by Jersey 2.</td>
  </tr>
  <tr>
    <td><a href="https://search.maven.org/artifact/org.lz4/lz4-java"><em>org.lz4:lz4-java</em></a></td>
    <td>Compression library.</td>
  </tr>
  </tbody>
</table>
<p>
Make sure your application OSGi bundle embeds the required artifacts from the above list.
An artifact can be embedded by adding it in scope <em>compile</em> to the <em>dependencies</em> section in pom.xml.
Typically, these artifacts have until now been used in scope <em>provided</em>.
Use <code>mvn dependency:tree</code> to check whether any of the listed artifacts are directly or transitively included
as dependencies.
</p>
<p>
As always, remove any dependencies that are not required by your project. Consult the Maven documentation on
<a href="https://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html#dependency-exclusions">
Dependency Exclusions</a> for how to remove a transitively included dependency.
</p>

An example adding <em>org.json:json</em> as a compile scoped dependency:
<pre>
&lt;dependencies&gt;
  ...
  &lt;dependency&gt;
    &lt;groupId&gt;org.json&lt;/groupId&gt;
    &lt;artifactId&gt;json&lt;/artifactId&gt;
    &lt;version&gt;20211205&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;
  &lt;/dependency&gt;
  ...
&lt;/dependencies&gt;
</pre>

<!--
<h2 id="removed-http-apis">Removed HTTP API's</h2>
<p>
The following HTTP APIs are removed:
</p>
<table width="100%" class="table">
  <thead>
    <tr>
      <th width="50%">Name</th><th>Replacement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>:
      </td>
      <td>.
      </td>
    </tr>
  </tbody>
</table>
-->


<h2 id="removed-http-api-parameters">Removed HTTP API parameters</h2>
<p>
The following HTTP API parameters are removed:
</p>
<table class="table">
  <thead>
  <tr>
    <th>Standard API path</th><th>Parameter name</th><th>Replacement</th>
  </tr>
  </thead>
  <tbody>
  <tr> <td>/search/</td><td><em>pos.ll</em></td> <td>add a
<a href="reference/query-language-reference.html#geolocation">geoLocation</a>
item to your query</td> </tr>
  <tr> <td>/search/</td><td><em>pos.radius</em></td> <td>add a
<a href="reference/query-language-reference.html#geolocation">geoLocation</a>
item to your query</td> </tr>
  </tbody>
</table>



<h2 id="removed-command-line-tools">Removed command line tools</h2>

<h3 id="vespa-http-client">vespa-http-client</h3>
<p>
  The <code>vespa-http-client</code> command line tool is removed in Vespa 8 and is replaced by the new
  <a href="vespa-feed-client.html">vespa-feed-client</a>. The new client uses
  <a href="performance/http2.html">HTTP/2</a> and the <a href="document-v1-api-guide.html">Document v1 API</a>.
</p>
<p>
  The underlying rest API used by the vespa-http-client will still be available and supported on Vespa 8.
  You can therefore continue to use an old client distributed with Vespa 7 to feed to a Vespa 8 installation.
  Note that we will not release any updates for vespa-http-client after the initial Vespa 8 release,
  although we will provide fixes and security updates to the rest API itself.
  We strongly recommend that you migrate away from vespa-http-client in a timely manner.
</p>



<h2 id="removed-metrics">Removed metrics</h2>
<p>
The following metrics are removed:
</p>
<table class="table">
  <thead>
    <tr>
      <th>Name</th><th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>http.status.401.rate</em></td>
      <td>Use <em>http.status.4xx.rate</em> with dimension <em>statusCode</em>==401</td>
    </tr>
    <tr>
      <td><em>http.status.403.rate</em></td>
      <td>Use <em>http.status.4xx.rate</em> with dimension <em>statusCode</em>==403</td>
    </tr>
  </tbody>
</table>


<!--
<h2 id="empty-fields">Empty fields</h2>
<p>
Check is empty field handling is changed ...
</p>
-->


<!--
<h2 id="uri-encoding">Allowed characters in request URIs</h2>
<p>
check ...
</p>
-->


<!--
<h2 id="changes-to-the-default-json-result-format">Changes to the default JSON result format</h2>
<p>
Check ...
</p>
-->


<!--
<h2 id="renamed-metrics">Renamed metrics</h2>
<p>
The following metrics are renamed:
</p>
<table width="100%" class="table">
  <thead>
    <tr>
      <th width="50%">Old Name</th><th>New Name</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>:</td><td>.</td></tr>
  </tbody>
</table>
-->



<h2 id="document-selection-exact-type-matching">Exact matching of document types in selection language</h2>
<p>
  The <a href="reference/document-select-language.html">document selection language</a> now
  uses <em>exact</em> matching for document types rather than <em>inheritance</em> ("is-a")
  matching.
</p>
<p>
  Example with two minimal document schemas:
</p>
<ul>
  <li><code>document my_doc_type {}</code></li>
  <li><code>document my_extended_doc_type inherits my_doc_type {}</code></li>
</ul>
<p>
  Previously, the selection expression <code>my_doc_type</code> would match both a document instance of
  type <code>my_doc_type</code> <em>and</em> <code>my_extended_doc_type</code>. It will now
  <em>only</em> match a document of type <code>my_doc_type</code>.
</p>

<h2 id="security">Security</h2>
<h3 id="strict-mode">Strict mode enabled by default</h3>
<p>
  <em>Strict mode</em> for request filtering in the jdisc container is enabled by default in Vespa 8.
  See documentation on the <a href="https://docs.vespa.ai/en/reference/services-http.html#filtering"><code>strict-mode</code></a>
  attribute in services.xml for details.
</p>

<h3 id="request-headers-for-remote-in-access-log">Request headers controlling remote host/port in access log</h3>
<p>
  The jdisc container will use the <em>X-Forwarded-For</em> and <em>X-Forwarded-Port</em> request headers to set the remote
  host and port respectively in the access log. The following request headers will no longer be handled by default:
</p>
<ul>
  <li>y-ra</li>
  <li>yahooremoteip</li>
  <li>client-ip</li>
  <li>y-rp</li>
</ul>

<h2 id="operating-system">Operating system support for Vespa artifacts</h2>
<h3 id="supported-rpm-os">RPMs</h3>
<p>
  The supported OS for Vespa RPMs will change from <a href="https://www.centos.org/centos-linux/">CentOS Linux 7</a> to
  <a href="https://www.centos.org/centos-stream/">CentOS Stream 8</a> for Vespa 8. RPMs will still be built
  and distributed on <a href="https://copr.fedorainfracloud.org/coprs/g/vespa/vespa/">Fedora Copr</a>. If you install Vespa
  RPMs you will have to upgrade your OS to <a href="https://www.centos.org/centos-stream/">CentOS Stream 8</a>.
</p>

<h3 id="supported-container-os">OCI containers (Docker containers)</h3>
<p>
  The base image used in our OCI containers will change from <a href="https://hub.docker.com/_/centos">docker.io/centos:7</a>
  to <a href="https://quay.io/repository/centos/centos?tab=tags">quay.io/centos/centos:stream8</a> for Vespa 8. This means that
  the container image will be built and tested on systems running kernel version <em>4.18.0</em> (current kernel for CentOS Stream 8).
  If you use our container image, you should upgrade the hosts running the containers to the same or a newer kernel version.
</p>

<h2 id="other-changes">Other changes</h2>

<h3 id="unknown-summary-classes">Unknown summary classes</h3>
<p>
  Queries that specify a non-existent <a href="document-summaries.html#summary-classes-in-queries">summary class</a>
  will now fail, instead of being rendered empty. Queries hitting multiple document types must use a summary class
  that exists in all of them
</p>

<h3 id="rank-features-must-be-float-or-tensors">Rank features must be floats or tensors</h3>
<p>
  If the value of a rank feature set in the query is not a float or tensor, Vespa 7 will
  automatically convert it to a float by taking the hash of the values toString. On Vespa 8
  this will instead be an illegal assignment.
</p>


<h3 id="qrserver-service-name">The "qrserver" service name</h3>
<p>
  Vespa containers are in general using "container" as their service name. However, a container cluster that has
  declared neither <a href="reference/services-docproc.html">document-processing</a> nor
  <a href="reference/services-container.html#document-api">document-api</a> used to be named "qrserver".
  From Vespa 8, all container clusters will use the service name "container". This affects the output of all
  metrics APIs, as well as the Vespa log output.
</p>


<h3 id="container-access-logs">Container access logs</h3>
<p>
  The folder for container access logs has been moved from <code>$VESPA_HOME/logs/vespa/qrs/</code> to
  <code>$VESPA_HOME/logs/vespa/access/</code>. For backwards compatibility, there is a symlink with the
  old name pointing to the new folder.
</p>


<h3 id="onnx-in-summary-features">ONNX output in summary features</h3>
<p>
  When defining an ONNX model output in summary features, Vespa 8 will ensure that the summary feature name is <code>onnx</code>
  rather than <code>onnxModel</code> as in previous version.
</p>


<h3 id="rankfeatures">Changes in rankfeatures</h3>
<p>
  Vespa can calculate and return all <a href="https://docs.vespa.ai/en/reference/query-api-reference.html#ranking.listFeatures">rank-features</a>
  in the <code>rankfeatures</code> summary field. Vespa 8 introduces some changes to this list:
</p>
<ul>
  <li><code>now</code> is removed</li>
  <li><code>bm25(field)</code> is added</li>
</ul>


<h3 id="storage-routing-policy">The "storage" message bus routing policy is removed</h3>
<p>
  The "storage" routing policy was removed in early Vespa 7, and clients specifying it have been forwarded to
  the content routing policy for backwards compatibility.  The forwarding is removed on Vespa 8 and clients needs
  be updated.
</p>
<p>
  Replace all usages of the "storage" policy with "content", which behaves identically.
</p>


<h3 id="vespa-dispatch-bin-process-is-removed">vespa-dispatch-bin process is removed</h3>
<p>
  The dispatch functionality is moved into the Vespa Container
  and the <em>vespa-dispatch-bin</em> process is removed.
  As this is not a public interface,
  the default was switched to <strong>not</strong> using vespa-dispatch-bin in Vespa-7.109.10.
  The process was removed in subsequent Vespa releases:
<table class="table">
  <tr>
    <td><a href="query-api.html">Dispatch</a></td>
    <td>Content cluster</td>
    <td>dynamically allocated in 19100 - 19899 range</td>
    <td>$VESPA_HOME/sbin/vespa-dispatch-bin</td>
    <td>Dispatcher, communicates between container and content nodes.
      Can be multi-level in a hierarchy</td>
  </tr>
</table>
<p>
  Rolling upgrade note: A rolling upgrade over Vespa-7.109.10 should work with no extra steps.
</p>

<h3 id="yql-statements-are-returned-without-semicolon">YQL statements are returned without semicolon</h3>
<p>
  When Vespa outputs an YQL statement, it will now not end the string by a semicolon.
  Terminating statements with semicolon continue to be optional and legal input.
</p>

