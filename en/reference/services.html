---
# Copyright Vespa.ai. All rights reserved.
title: "services.xml"
category: oss,cloud
---

<p><em>services.xml</em> specifies the clusters an application should have and their capabilities.
It is placed in the root of the
<a href="../application-packages.html">application package</a>.</p>

<p>Elements:</p>
<pre class="pre-config">
<a href="#services">services [version]</a>
  <a href="services-container.html">container [version]</a> - specifies a container cluster
  <a href="services-content.html">content   [version]</a> - specifies a content cluster
  <a href="services-admin.html">admin     [version]</a> - control plane configuration (rarely needed)
  <a href="/en/operations-selfhosted/routing.html#routing-services">routing   [version] - how content should be routed (rarely needed)</a>
</pre>



<h2 id="services">&lt;services&gt;</h2>

<table class="table">
    <thead>
    <tr><th>Attribute</th><th>Required</th><th>Value</th><th>Default</th><th>Description</th></tr>
    </thead>
    <tbody>
    <tr>
        <td>version</td>
        <td>required</td>
        <td>number</td>
        <td></td>
        <td>1.0 in this version of Vespa</td>
    </tr>
    </tbody>
</table>

<p>Optional subelements (one or more of <em>container</em> or <em>content</em> is required):</p>

<ul>
  <li><a href="services-container.html">&lt;container&gt;</a></li>
  <li><a href="services-content.html">&lt;content&gt;</a></li>
  <li><a href="services-admin.html">&lt;admin&gt;</a></li>
  <li><a href="/en/operations-selfhosted/routing.html#routing-services">&lt;routing&gt;</a></li>
</ul>

<p>The rest of this document describes tags that are used within multiple services tags.</p>


<h2 id="nodes">&lt;nodes&gt;</h2>

<p>The <em>nodes</em> element configures the hardware resources of a cluster, and so is used in both
container and content clusters. This tag works differently on Vespa Cloud and self-managed instances:</p>

<ul>
  <li>
    Vespa Cloud: The number of nodes are specified by a <em>count</em> attribute,
    and the resources of each node by a <a href="#resources">resource</a> child element.
  </li>
  <li>
    Self-managed: <em>nodes</em> have a <a href="#node">node</a> child element for each node,
    A node referred to in <em>services.xml</em> must be defined in
    <a href="hosts.html">hosts.xml</a> using <em>hostalias</em>.
  </li>
</ul>

<p>It is possible to specify both to make an application package work in both environments, and
it is always possible to deploy either type for development on the other:
When the nodes tag has Vespa Cloud content it is interpreted as a single-node cluster
in a self-hosted environment and vice versa.</p>

<table class="table">
    <thead>
    <tr>
        <th>Attribute</th>
        <th>type</th>
        <th>Default</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><strong>count</strong></td>
        <td>integer or range</td>
        <td></td>
        <td>Vespa Cloud: The number of nodes of the cluster.</td>
    </tr>
    <tr>
        <td><strong>exclusive</strong></td>
        <td>boolean</td>
        <td>false</td>
        <td>
            Optional. Vespa Cloud: If true these nodes will never be placed on shared hosts even when this would
            otherwise be allowed (which is only for content nodes in some environments).
            When nodes are allocated exclusively, the resources must match the resources of the host exactly.
        </td>
    </tr>
    <tr>
        <td><strong>groups</strong></td>
        <td>integer or range</td>
        <td></td>
        <td>
          Vespa Cloud content nodes only, optional: Integer or range.
          Sets the number of groups into which content nodes should be divided.
          Each group will have an equal share of the nodes, and one or more complete copies of the corpus and index,
          and each query will be routed to just one group -
          see <a href="/en/elasticity.html#grouped-distribution">grouped distribution</a>.
          This allows <a href="/en/performance/sizing-examples.html">scaling</a>
          to a higher query load than is possible with just a single group.
        </td>
    </tr>
    <tr>
        <td><strong>group-size</strong></td>
        <td>integer or range</td>
        <td></td>
        <td>
          Vespa Cloud content nodes only, optional: Integer or range where either value can be skipped
          (replaced by an empty string) to create a one-sided limit.
          This can be set as an alternative to explicitly setting <code>groups</code>:
          The group sizes used will always be within these limits (inclusive), for any <code>count</code>.
        </td>
    </tr>
    </tbody>
</table>

<p>If neither <em>groups</em> nor <em>group-size</em> is set, all nodes belong to a single group.
Read more in <a href="/en/cloud/topology-and-resizing.html">topology</a>.</p>

<p>Ranges are expressed by the syntax <code>[lower-limit, upper-limit]</code>; Both limits are inclusive.
Any value set as a range will be <a href="../cloud/autoscaling.html">autoscaled</a>.</p>


<h2 id="resources">Vespa Cloud: &lt;resources&gt;</h2>

<p>Specifies the resources each node in the cluster should have.</p>

<p>The resources must match a node flavor in
<a href="https://cloud.vespa.ai/en/reference/aws-flavors.html">AWS</a>,
<a href="https://cloud.vespa.ai/en/reference/gcp-flavors.html">GCP</a>
<a href="https://cloud.vespa.ai/en/reference/azure-flavors.html">Azure</a>,
depending on where you are deploying.
Exception: If you use remote disk, you can specify any number lower than the max size.</p>

<p><strong>Subelements:</strong> <a href="#gpu">&lt;gpu&gt;</a></p>
<table class="table">
  <thead>
    <tr>
      <th>Attribute</th>
      <th>type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><b>vcpu</b></td>
      <td>float or range</td>
      <td>2</td>
      <td>CPU (virtual threads)</td>
    </tr>
    <tr>
      <td><b>memory</b></td>
      <td>float or range, each followed by a byte unit, such as "Gb"</td>
      <td>8 Gb in container clusters, 16 Gb in content clusters</td>
      <td>Memory</td>
    </tr>
    <tr>
      <td><b>disk</b></td>
      <td>float or range, each followed by a byte unit, such as "Gb"</td>
      <td>50 in container clusters, 300 in content clusters</td>
      <td>
        Disk space. To fit core dumps/heap dumps, the disk space should be larger than 3 x memory size for content nodes,
        2 x memory size for container nodes.
      </td>
    </tr>
    <tr>
      <td><b>storage-type</b>
      <td>string (enum)</td>
      <td><code>any</code></td>
      <td>
        The type of storage to use.
        This is useful to specify local storage when network storage provides insufficient io operations or too noisy io performance:
        <ul>
          <li><code>local</code>: Node-local storage is required.</li>
          <li><code>remote</code>: Network storage must be used.</li>
          <li><code>any</code>: Both remote or local storage may be used.</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>disk-speed</b>
      <td>string (enum)</td>
      <td><code>fast</code></td>
      <td>The required disk speed category:
        <ul>
          <li><code>fast</code>: SSD-like disk speed is required</li>
          <li><code>slow</code>: This is sized for spinning disk speed</li>
          <li><code>any</code>: Performance does not depend on disk speed (often suitable for container clusters).</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>architecture</strong></td>
      <td>string (enum)</td>
      <td><code>any</code></td>
      <td>Node CPU architecture:
        <ul class="table">
          <li><code>x86_64</code></li>
          <li><code>arm64</code></li>
          <li><code>any</code>: Use any of the available architectures.</li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p>Ranges are expressed by the syntax <code>[lower-limit, upper-limit]</code>; Both limits are inclusive.
Any value set as a range will be <a href="../cloud/autoscaling.html">autoscaled</a>.</p>


<h2 id="node">Self-managed: &lt;node&gt;</h2>

<p>Specifies a node that should be a member in the cluster.</p>

<table class="table">
    <thead>
    <tr><th>Attribute</th><th>Required</th><th>Value</th><th>Default</th><th>Description</th></tr>
    </thead>
    <tbody>
    <tr>
        <th>hostalias</th>
        <td>required</td>
        <td>string</td>
        <td></td>
        <td><p id="node.hostalias">a host name which must be mapped to a full hostname in <a href="hosts.html">hosts.xml</a></p></td>
    </tr>
</tbody>
</table>


<h2 id="gpu">&lt;gpu&gt;</h2>

<p>Vespa Cloud: Declares GPU resources to provision.</p>

<p>Limitations:</p>

<ul>
  <li>Available in AWS zones only</li>
  <li>Valid for container clusters only</li>
</ul>

<table class="table">
  <thead>
    <tr>
      <th>Attribute</th><th>type</th><th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><b>count</b></td>
      <td>integer</td>
      <td>Number of GPUs</td>
    </tr>
    <tr>
      <td><b>memory</b></td>
      <td>integer, followed by a byte unit, such as "Gb"</td>
      <td>
        Amount of memory per GPU. Total amount of GPU memory available is this
        number multiplied by <code>count</code>.
      </td>
    </tr>
  </tbody>
</table>

<p id="gpu-example">Example:</p>
<pre>{% highlight xml %}
<nodes count="2">
    <resources vcpu="4" memory="16Gb" disk="125Gb">
        <gpu count="1" memory="16Gb"/>
    </resources>
</nodes>
{% endhighlight %}</pre>


<h2 id="generic-config">Generic configuration using &lt;config&gt;</h2>

<p>Most elements in <em>services.xml</em> accept a sub-element named <em>config</em>.
<em>config</em> elements can be included on different levels in the XML structure
and the lower-level ones will override values in the higher-level ones (example below).
The <em>config</em> element must include the attribute <em>name</em>,
which gives the full name of the configuration option in question, including the namespace.
The name can either refer to configuration definitions that are shipped with Vespa
or ones that are part of the <a href="config-files.html">application package</a>. For a
complete example on generic configuration see the
<a href="config-files.html#generic-configuration-in-services-xml">application package</a> reference.
</p>
<pre>{% highlight xml %}
<container id="default" version="1.0">
    <handler id="com.yahoo.vespatest.ConfiguredHandler">
        <config name="vespatest.response">
            <response>configured string</response>
        </config>
    </handler>
</container>
{% endhighlight %}</pre>


<h2 id="modular">Modular Configuration</h2>

<p>Some features are configurable using XML files in subdirectories of the application package.
This means that the configuration found in these XML files
will be used as if it was inlined in <em>services.xml</em>.
This is supported for <a href="services-search.html#chain">search chains</a>,
<a href="services-docproc.html">docproc chains</a> and
<a href="/en/operations-selfhosted/routing.html#routing-services">routing tables</a>.</p>
