---
# Copyright Vespa.ai. All rights reserved.
title: "Query API Reference"
redirect_from:
- /documentation/reference/query-api-reference.html
- /en/reference/search-api-reference.html
---

<p>Refer to the <a href="../query-api.html">Query API guide</a> for API examples.</p>
<p>
All the request parameters listed below can be set in query profiles.
The first four blocks of properties are also modeled as
<a href="../query-profiles.html#query-profile-types">query profile types</a>.
These types can be referred from query profiles (and inheriting types)
to provide type checking on the parameters.
</p><p>
These parameters often have both a full name -
including the path from the root query profile -
and one or more abbreviated names.
Both names can be used in requests,
while only full names can be used in query profiles.
The full names are case-sensitive, abbreviated names are case-insensitive.
</p><p>
The parameters modeled as query profiles are also available through
get methods as Java objects from the Query to Searcher components.
</p>



<h2 id="parameters">Parameters</h2>
<dl>
<dt>Query</dt>
<dd>
  <ul>
    <li><a href="#yql">yql</a></li>
  </ul>
</dd>

<dt>Native Execution Parameters</dt>
<dd>
  <ul>
    <li><a href="#hits">hits</a> [<em>count</em>]</li>
    <li><a href="#offset">offset </a>[<em>start</em>]</li>
    <li><a href="#queryprofile">queryProfile</a></li>
    <li><a href="#groupingsessioncache">groupingSessionCache</a></li>
    <li><a href="#searchchain">searchChain</a></li>
    <li><a href="#timeout">timeout</a></li>
  </ul>
</dd>

<dt>Query Model</dt>
<dd>
  <ul>
    <li><a href="#model.defaultindex">model.defaultIndex</a> [<em>default-index</em>]</li>
    <li><a href="#model.encoding">model.encoding</a> [<em>encoding</em>]</li>
    <li><a href="#model.filter">model.filter</a> [<em>filter</em>]</li>
    <li><a href="#model.locale">model.locale</a> [<em>locale</em>]</li>
    <li><a href="#model.language">model.language</a> [<em>lang, language</em>]</li>
    <li><a href="#model.querystring">model.queryString</a> [<em>query</em>]</li>
    <li><a href="#model.restrict">model.restrict</a> [<em>restrict</em>]</li>
    <li><a href="#model.searchpath">model.searchPath</a> [<em>path</em>]</li>
    <li><a href="#model.sources">model.sources</a> [<em>search, sources</em>]</li>
   <li><a href="#model.type">model.type</a> [<em>type</em>]</li>
  </ul>
</dd>

<dt>Ranking</dt>
<dd>
  <ul>
    <li><a href="#ranking.location">ranking.location</a> [<em>location</em>]</li>
    <li><a href="#ranking.features">ranking.features</a> [<em>input</em>, <em>rankfeature</em>]</li>
    <li><a href="#ranking.listfeatures">ranking.listFeatures</a> [<em>rankfeatures</em>]</li>
    <li><a href="#ranking.profile">ranking.profile</a> [<em>ranking</em>]</li>
    <li><a href="#ranking.properties">ranking.properties</a> [<em>rankproperty</em>]</li>
    <li><a href="#ranking.softtimeout.enable">ranking.softtimeout.enable</a></li>
    <li><a href="#ranking.sorting">ranking.sorting</a> [<em>sorting</em>]</li>
    <li><a href="#ranking.freshness">ranking.freshness</a></li>
    <li><a href="#ranking.querycache">ranking.queryCache</a></li>
    <li><a href="#ranking.rerankcount">ranking.rerankCount</a></li>
    <li><a href="#ranking.keeprankcount">ranking.keepRankCount</a></li>
    <li><a href="#ranking.rankscoredroplimit">ranking.rankScoreDropLimit</a></li>
    <li><a href="#ranking.secondphase.rankscoredroplimit">ranking.secondPhase.rankScoreDropLimit</a></li>
    <li><a href="#ranking.globalphase.rerankcount">ranking.globalPhase.rerankCount</a></li>
    <li><a href="#ranking.matching">ranking.matching</a></li>
    <li><a href="#ranking.matchPhase">ranking.matchPhase</a></li>
    <li><a href="#ranking.significance.useModel">ranking.significance.useModel</a></li>
  </ul>
</dd>

<dt>Presentation</dt>
<dd>
  <ul>
    <li><a href="#presentation.bolding">presentation.bolding</a> [<em>bolding</em>]</li>
    <li><a href="#presentation.format">presentation.format</a> [<em>format</em>]</li>
    <li><a href="#presentation.template">presentation.template</a></li>
    <li><a href="#presentation.summary">presentation.summary</a> [<em>summary</em>]</li>
    <li><a href="#presentation.timing">presentation.timing</a></li>
  </ul>
</dd>

<dt>Grouping</dt>
<dd>
  <ul>
    <li><a href="#select">select</a></li>
    <li><a href="#collapse.summary">collapse.summary</a></li>
    <li><a href="#collapsefield">collapsefield</a></li>
    <li><a href="#collapsesize">collapsesize</a>
    <li><a href="#collapsesize.fieldname">collapsesize</a> [<em>fieldname</em>]</li>
    <li><a href="#grouping.defaultmaxgroups">grouping.defaultMaxGroups</a></li>
    <li><a href="#grouping.defaultmaxhits">grouping.defaultMaxHits</a></li>
    <li><a href="#grouping.globalmaxgroups">grouping.globalMaxGroups</a></li>
    <li><a href="#grouping.defaultprecisionfactor">grouping.defaultPrecisionFactor</a></li>
  </ul>
</dd>

<dt>Streaming</dt>
<dd>
  <ul>
    <li><a href="#streaming.groupname">streaming.groupname</a></li>
    <li><a href="#streaming.selection">streaming.selection</a></li>
    <li><a href="#streaming.maxbucketspervisitor">streaming.maxbucketspervisitor</a></li>
  </ul>
</dd>

<dt>Tracing</dt>
<dd>
  <ul>
    <li><a href="#trace.level">trace.level</a></li>
    <li><a href="#trace.explainlevel">trace.explainLevel</a></li>
    <li><a href="#trace.profiledepth">trace.profileDepth</a></li>
    <li><a href="#trace.profiling.matching.depth">trace.profiling.matching.depth</a></li>
    <li><a href="#trace.profiling.firstPhaseRanking.depth">trace.profiling.firstPhaseRanking.depth</a></li>
    <li><a href="#trace.profiling.secondPhaseRanking.depth">trace.profiling.secondPhaseRanking.depth</a></li>
    <li><a href="#trace.timestamps">trace.timestamps</a></li>
    <li><a href="#trace.query">trace.query</a></li>
  </ul>
</dd>

<dt>Semantic Rules</dt>
<dd>
  <ul>
    <li><a href="#rules.off">rules.off</a></li>
    <li><a href="#rules.rulebase">rules.rulebase</a></li>
    <li><a href="#tracelevel.rules">tracelevel.rules</a></li>
  </ul>
</dd>

<dt>Dispatch</dt>
<dd>
  <ul>
    <li><a href="#dispatch.topkprobability">dispatch.topKProbability</a></li>
  </ul>
</dd>

<dt>Other</dt>
<dd>
  <ul>
    <li><a href="#recall">recall</a></li>
    <li><a href="#user">user</a></li>
    <li><a href="#hitcountestimate">hitcountestimate</a></li>
    <li><a href="#metrics.ignore">metrics.ignore</a></li>
    <li><a href="#weakand.replace">weakAnd.replace</a></li>
    <li><a href="#wand.hits">wand.hits</a></li>
    <li><a href="#sorting.degrading">sorting.degrading</a></li>
    <li><a href="#nocache">noCache</a></li>
  </ul>
</dd>
</dl>



<h2 id="query">Query</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>yql</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="yql">
        See the <a href="../query-language.html">YQL query guide</a> for examples,
        and the <a href="query-language-reference.html">reference</a> for details.
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="native-execution-parameters">Native Execution Parameters</h2>
<p>
These parameters are defined in the <code>native</code> query profile type.
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>hits</th>
    <td>count</td>
    <td>Number</td>
    <td>10</td>
    <td>
      <p id="hits">
        A positive integer, including 0.
        The maximum number of hits to return from the result set.
      </p>
      <p>
        <code>hits</code> is capped at <code>maxHits</code>, default 400.
        <code>maxHits</code> can be set in a <a href="../query-profiles.html">query profile</a>.
      </p>
      <p>
        Number of hits can also be set in <a href="query-language-reference.html#limit-offset">YQL</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>offset</th>
    <td>start</td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="offset">
        To implement pagination: The number of hits to skip when returning the result.
        A positive integer, including 0.
      </p>
      <p>
        <code>offset</code> is capped at <code>maxOffset</code>, default 1000.
        <code>maxOffset</code> can be set in a <a href="../query-profiles.html">query profile</a>.
      </p>
      <p>
        Offset can also be set in <a href="query-language-reference.html#limit-offset">YQL</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>queryProfile</th>
    <td></td>
    <td>String</td>
    <td><code>default</code></td>
    <td>
      <p id="queryprofile">
        A query profile id with format <code>name:version</code>,
        where version can be omitted or partially specified,
        e.g. <code>myprofile:2.1</code>.
        A <a href="../query-profiles.html">query profile</a> has default properties for a query.
        The default query profile is named <em>default</em>.
    </td>
  </tr>
  <tr>
    <th>groupingSessionCache</th>
    <td></td>
    <td>Boolean</td>
    <td>true</td>
    <td>
      <p id="groupingsessioncache">
        Set to true to enable grouping session cache.
        See the <a href="grouping-syntax.html#grouping-session-cache">grouping reference</a> for details.
      </p>
    </td>
  </tr>
  <tr>
    <th>searchChain</th>
    <td></td>
    <td>String</td>
    <td><code>default</code></td>
    <td>
      <p id="searchchain">
        A search chain id with format <code>name:version</code>,
        where version can be omitted or partially specified,
        e.g. <code>mychain:2.1.3</code>.
        The <a href="../components/chained-components.html">search chain</a>
        initially invoked when processing the query.
        This search chain may invoke other chains.
      </p>
    </td>
  </tr>
  <tr>
    <th>timeout</th>
    <td></td>
    <td>String</td>
    <td>0.5s</td>
    <td>
      <p id="timeout">
        Positive floating point number with an optional unit. Default unit
        is seconds (s), valid unit strings are e.g. <em>ms</em> and <em>s</em>. To set
        a timeout of one minute, the argument could be set to <em>60 s</em>.
        Space between the number and the unit is optional.
      </p>
      <p>
        It specifies the overall timeout of the query execution
        and can be defined in a <a href="../query-profiles.html">query profile</a>.
        Different classes of queries can then easily have a different latency budget/timeout using different profiles.
      </p>
      <p>
        At timeout, the hits generated thus far are returned,
        refer to <a href="#ranking.softtimeout.enable">ranking.softtimeout.enable</a>
        for details on HTTP status codes and response elements.
      </p>
      <p>Refer to the <a href="../query-api.html#timeout">Query API guide</a> for more details on timeout handling.</p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="query-model">Query Model Parameters</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>model.defaultIndex</th>
    <td>default-index</td>
    <td>String</td>
    <td><code>default</code></td>
    <td>
      <p id="model.defaultindex">
        An index name.
        The field which is searched for query terms which doesn't explicitly specify an index.
        Also see the <a href="query-language-reference.html#defaultindex">defaultIndex</a> query annotation.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.encoding</th>
    <td>encoding</td>
    <td>String</td>
    <td><code>utf-8</code></td>
    <td>
      <p id="model.encoding">
        Encoding names or aliases defined in the
        <a href="https://www.iana.org/assignments/character-sets/character-sets.xhtml">IANA character sets</a>.
        Sets the encoding to use when returning a result.
        The query is always encoded as UTF-8, independently of how the result will be encoded.
      </p>
      <p>
        The encodings <code>big5</code>, <code>euc-jp</code>, <code>euc-kr</code>, <code>gb2312</code>,
        <code>iso-2022-jp</code> and <code>shift-jis</code>
        also influences how <a href="../linguistics.html#tokenization">tokenization</a> is done
        in the absence of an explicit language setting.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.filter</th>
    <td>filter</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.filter">
        A filter string in the <a href="simple-query-language-reference.html">Simple Query Language</a>.
        Sets a filter to be combined with the <a href="#model.querystring">model.queryString</a>.
        Typical use of a filter is to add machine generated or preferences based filter terms to the user query.
      </p>
      <p>
        Terms which are passed in the filter are not <a href="#presentation.bolding">bolded</a>.
        The filter is parsed the same way as a query of type <code>any</code>,
        the full syntax is available.
        The positive terms (preceded by +) and phrases act as AND filters,
        the negative terms (preceded by -) act as NOT filters,
        while the unprefixed terms will be used to RANK the results.
        Unless the query has no positive terms,
        the filter will only restrict and influence ranking of the result set,
        never cause more matches than the query.
      </p>
      <p>
        Consider using query profiles to add filters to the YQL string,
        <a href="/en/query-profiles.html#example">example</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.locale</th>
    <td>locale</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.locale">
        A language tag from <a href="https://www.rfc-editor.org/rfc/rfc5646">RFC 5646</a>.
        Sets the locale and language to use when parsing queries from a language tag, such as <code>en-US</code>.
        This attribute should always be set when it is known.
        If this parameter is not set, it will be guessed from the query and encoding,
        and default to english if it cannot be guessed.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.language</th>
    <td>lang, language</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.language">
        A language tag from <a href="https://www.rfc-editor.org/rfc/rfc5646">RFC 5646</a>,
        but allowing underscore instead of dash as separator character.
        A legacy alternative to locale. When this value is accessed,
        underscores will be replaced by dashes in the returned value.
        Also see the <a href="query-language-reference.html#language">language</a> query term annotation.
        <!-- ToDo: refer to model.locale for how this will default to English.
                   Also link to linguistics docs for examples / more info ... -->
      </p>
    </td>
  </tr>
  <tr>
    <th>model.queryString</th>
    <td>query</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.querystring">
        A query string in the <a href="simple-query-language-reference.html">Simple Query Language</a>.
        It is combined with <a href="#model.filter">model.filter</a>.
        See the <a href="query-language-reference.html#userquery">userQuery</a> operator for how to combine with YQL.
        Can also be used without YQL.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.restrict</th>
    <td>restrict</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.restrict">
        A comma-delimited list of document type (schema) names, defaulting to all schemas if not set.
        See <a href="../schemas.html#multiple-schemas">multiple schemas</a> and
        <a href="../federation.html">federation</a>.
      </p>
      <p>
        Use <a href="#model.sources">model.sources</a> to restrict to content cluster names or other source names.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.searchPath</th>
    <td>searchpath</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.searchpath">
        Specification of which content nodes a query should be sent to.
        This is useful for debugging/monitoring
        and when using <a href="../phased-ranking.html#rank-phase-statistics">Rank phase statistics</a>.
        Note that in a content cluster with flat distribution (i.e. no &lt;group&gt; element in <em>services.xml</em>),
        there is 1 implicit group.
      </p>
      <p>
        If not set, defaults to all nodes in one group, selected by load balancing.
      </p>
      <p><code>searchpath::ELEMENT [';' ELEMENT]*</code></p>
      <p><code>ELEMENT::NODE ['/' GROUP]</code></p>
      <p><code>NODE::EXP [',' EXP]*</code></p>
      <p><code>EXP::NUM | RANGE</code></p>
      <p><code>GROUP::NUM | '*'</code></p>
      <p><code>RANGE::'['NUM ',' NUM ' &gt;'</code></p>
      <p>Examples:</p>
      <ul>
        <li><code>7/3</code> = node 7, group 3.</li>
        <li><code>7/</code> = node 7, any group.</li>
        <li><code>*/0</code> = all nodes in group 0</li>
        <li><code>7,1,9/0</code> = nodes 1,7 and 9, group 0.</li>
        <li><code>1,[3,9&gt;/0</code> = nodes 1,3,4,5,6,7,8, group 0.</li>
      </ul>
    </td>
  </tr>
  <tr>
    <th>model.sources</th>
    <td>search, sources</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="model.sources">
        A comma-separated list of content cluster names or other source names,
        defaulting to all sources/clusters if not set.
        The names of the sources to query, e.g. one or more content clusters and/or federated sources -
        see <a href="../schemas.html#content-cluster-mapping">content cluster mapping</a>.
        Also see <a href="../federation.html">federation</a>.
      </p>
      <p>
        Use <a href="#model.restrict">model.restrict</a> to restrict to schemas.
      </p>
    </td>
  </tr>
  <tr>
    <th>model.type</th>
    <td>type</td>
    <td>String</td>
    <td><code>weakAnd</code></td>
    <td>
      <p id="model.type">
        Selects the query language syntax of the
        <a href="#model.querystring">model.queryString</a> parameter:
        <code>all</code>, <code>weakAnd</code>, <code>any</code>, <code>phrase</code>,
        <code>tokenize</code>, <code>web</code>, <code>yql</code> -
        refer to <a href="simple-query-language-reference.html">simple query language reference</a>.
        Also see <a href="query-language-reference.html#userinput">YQL grammar</a>.
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="ranking">Ranking</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>ranking.location</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="ranking.location">
        See <a href="../geo-search.html">Geo search</a>.
        Point (two-dimensional location) to use as base for location ranking.
      </p>
      {% include deprecated.html content=" Deprecated in favor of adding a
      <a href='query-language-reference.html#geolocation'>geoLocation</a>
      item to the query tree.
      Use inside a <a href='query-language-reference.html#rank'>rank</a> operator
      if it should be used only for ranking)."%}
    </td>
  </tr>
  <tr>
    <th>ranking.features<br/>.<em>featurename</em></th>
    <td>input<br/>.<em>featurename</em>, rankfeature<br/>.<em>featurename</em></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="ranking.features">
        Set a query rank feature input to a value.
        The key must be a query feature - <code>query(anyname)</code>,
        and the value must be a double, string (to be hashed to a double),
        or a tensor matching the <a href="schema-reference.html#inputs">declared input type</a>
        on <a href="tensor.html#tensor-literal-form">tensor literal form</a> -
        see the <a href="../tensor-user-guide.html#querying-with-tensors">tensor user guide</a>.
        Examples:
      </p>
      <p><code>input.query(userageDouble)=42.1</code></p>
      <p><code>input.query(stringToBeHashed)=abcd</code></p>
      <p><code>input.query(myIndexedTensor)=[1.0, 2.0, 3.0]</code></p>
      <p><code>input.query(myMappedTensor)={"Tablet Keyboard Cases": 0.8, "Keyboards":0.3}</code></p>
    </td>
  </tr>
  <tr>
    <th>ranking.listFeatures</th>
    <td>rankfeatures</td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="ranking.listfeatures">
        Set to true to request <em>all</em>
        <a href="schema-reference.html#rank-features">rank-features</a> to be calculated and returned.
        The rank features will be returned in the summary field <em>rankfeatures</em>.
        This option is typically used for MLR training, should not to be used for production.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.profile</th>
    <td>ranking</td>
    <td>String</td>
    <td><code>default</code></td>
    <td>
      <p id="ranking.profile">
        Sets <a href="schema-reference.html#rank-profile">rank profile</a>
        to use for assigning rank scores for documents.
        The <code>default</code> rank profile will be used for backends which does not have the given rank profile.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.properties<br/>.<em>propertyname</em></th>
    <td>rankproperty<br/>.<em>propertyname</em></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="ranking.properties">
        Set a <a href="schema-reference.html#rank-properties">rank property</a>
        that is passed to, and used by a feature executor for this query.
        Example: <code>query=foo&amp;ranking.properties.dotProduct.X={a:1,b:2}</code>
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.softtimeout<br/>.enable</th>
    <td></td>
    <td>Boolean</td>
    <td>true</td>
    <td>
      <p id="ranking.softtimeout.enable">
        By default, the hits available are returned on <a href="#timeout">timeout</a>.
        To return no hits at timeout instead, set <code>ranking.softtimeout.enable=false</code>.
      </p>
      <p>
        Softtimeout uses <code>ranking.softtimeout.factor</code> of the <a href="#timeout">timeout</a>, default 70%.
        The rest of the time budget is spent on later ranking phases.
      </p>
      <p>
        The factor is adaptive, per rank profile -
        the factor is adjusted based on remaining time after all ranking phases,
        unless overridden in the query using <code>ranking.softtimeout.factor</code>.
      </p>
      <p>
        A <a href="default-result-format.html#timeout">timeout</a> element is returned in the query response at timeout.
      </p>
      <p>
        Example: query with 500ms timeout, use 300ms in first-phase ranking:
        <code>&amp;ranking.softtimeout.enable=true<br/>&amp;ranking.softtimeout.factor=0.6<br/>&amp;timeout=0.5</code>
      </p>
      <p>
        The <code>ranking.softtimeout</code> settings controls what the content nodes should do
        in the case where the latency budget has almost been used (timeout times a factor).
        Return the documents recalled and ranked with the
        <a href="../phased-ranking.html">first phase function</a> within the time used,
        or simply don't produce a result:
      </p>
      <ul>
        <li>
          With soft timeout disabled, the Vespa container will return a 504 timeout without any results.
        </li>
        <li>
          When enabled, it will return the documents matched and ranked up until the timeout was reached,
          with a 200 OK response along with the reason the result set was degraded.
        </li>
      </ul>
      <p>
        The container might respond with a timeout error with HTTP response code 504 even with soft timeout enabled
        if the timeout is set so low that the query does not make it to the content nodes,
        or the container does not have any time left after input and query processing
        to dispatch the query to the content nodes.
      </p>
      <p>
        Read more about soft timeout in <a href="../graceful-degradation.html">coverage degradation</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.softtimeout<br/>.factor</th>
    <td></td>
    <td>Number</td>
    <td>0.7</td>
    <td>
      <p id="ranking.softtimeout.factor">
        See <a href="#ranking.softtimeout.enable">ranking.softtimeout.enable</a>.
      </p>
    </td>
  </tr>
  <!-- Internal note: No need to document tailcost - this is a parameter end users should not need to use - ref SoftTimeout.java -->
  <tr>
    <th>ranking.sorting</th>
    <td>sorting</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="ranking.sorting">
        A valid <a href="sorting.html">sort specification</a>.
        Fields you want to sort on must be stored as document attributes in the index structure
        by adding <a href="schema-reference.html#attribute">attribute</a> to the indexing statement.
        <!-- ToDo: Add example / link to example. Move the sortspec here instead-->
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.significance.useModel</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="ranking.sorting">
        Override query to enable or disable to use user provided <a href="services-search.html#significance">significance model</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.freshness</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="ranking.freshness">
        Sets the time which will be used as <em>now</em> during execution.
      </p>
      <p>
        <code>[integer]</code>, an absolute time in seconds since epoch, or <code>now-[number]</code>,
        to use a time [integer] seconds into the past, or <code>now</code> to use the current time.
      </p>
      <!-- ToDo: This doc is confusing, rewrite, and add/link to examples
                 Link to now rank feature-->
    </td>
  </tr>
  <tr>
    <th>ranking.queryCache</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="ranking.querycache">
        Turns query cache on or off. Query is a two-phase process.
        If the query cache is on, the query is stored on the content nodes between the first and second phase,
        saving network bandwidth and also query setup time, at the expense of using more memory.
        It only affects the protocol phase two,
        see <a href="../performance/caches-in-vespa.html">caches in Vespa</a>.
        It does not cache the result, it just saves resources by not forwarding the query twice
        (one for the first protocol phase which is find the best k documents from all nodes,
        to the second phase which is to fill summary data
        and potentially ranking features listed in summary-features in the rank profile).
      </p>
      <p>
        The <a href="schema-reference.html#summary-features">summary-features</a>
        are re-calculated but this setting avoids sending the query down once more.
        There is little downside of using it,
        and it can save resources and latency in cases where the query tree and query ranking features
        (e.g. tensors used in ranking) are large.
        As this is a protocol optimization, it also works with changing filter,
        it's not cached cross independent queries,
        it's just saving having to send the <span style="text-decoration: underline;">same</span> query twice.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.rerankCount</th>
    <td></td>
    <td>Number</td>
    <td></td>
    <td>
      <p id="ranking.rerankcount">
        Specifies the number of hits that should be ranked in the second ranking phase.
        Overrides the <a href="schema-reference.html#secondphase-rerank-count">rerank-count</a> set in the rank profile.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.keepRankCount</th>
    <td></td>
    <td>Number</td>
    <td></td>
    <td>
      <p id="ranking.keeprankcount">
        Specifies the number of hits that should keep rank value.
        Overrides the <a href="schema-reference.html#keep-rank-count">keep-rank-count</a> set in the rank profile.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.rankScoreDropLimit</th>
    <td></td>
    <td>Number</td>
    <td></td>
    <td>
      <p id="ranking.rankscoredroplimit">
        Minimum rankscore for a document to be considered a hit.
        Overrides the <a href="schema-reference.html#rank-score-drop-limit">rank-score-drop-limit</a> set in the rank profile.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.secondphase.rankscoredroplimit</th>
    <td></td>
    <td>Number</td>
    <td></td>
    <td>
      <p id="ranking.secondphase.rankscoredroplimit">
        Minimum rank score for a document to be considered a hit after second phase reranking or rescoring.
        Overrides the <a href="schema-reference.html#secondphase-rank-score-drop-limit">second phase rank-score-drop-limit</a> set in the rank profile.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.globalPhase.rerankCount</th>
    <td></td>
    <td>Number</td>
    <td></td>
    <td>
      <p id="ranking.globalphase.rerankcount">
        Specifies the number of hits that should be re-ranked in the global ranking phase.
        Overrides the <a href="schema-reference.html#globalphase-rerank-count">rerank-count</a> set in the rank profile.
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="ranking.matching">ranking.matching</h2>
<p>
  Settings to control behavior during matching of query evaluation.
  If these are set in the query, they will override any equivalent settings in the
  <a href="schema-reference.html#rank-profile">rank profile</a>.
  Detailed descriptions are found in the rank profile documentation.
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>ranking.matching<br/>.numThreadsPerSearch</th>
    <td></td>
    <td>integer</td>
    <td></td>
    <td>
      <p id="ranking.matching.numThreadsPerSearch">
        Rank profile equivalent: <a href="schema-reference.html#num-threads-per-search">num-threads-per-search</a>
      </p>
      <p>
        Overrides the global <a href="services-content.html#requestthreads-persearch">persearch</a> threads
        to a <strong>lower</strong> value.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matching<br/>.minHitsPerThread</th>
    <td></td>
    <td>integer</td>
    <td></td>
    <td>
      <p id="ranking.matching.minHitsPerThread">
        Rank profile equivalent: <a href="schema-reference.html#min-hits-per-thread">min-hits-per-thread</a></p>
      <p>
        After estimating the number of hits for a query,
        this number is used to decide how many search threads to use.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matching<br/>.numSearchPartitions</th>
    <td></td>
    <td>integer</td>
    <td></td>
    <td>
      <p id="ranking.matching.numSearchPartitions">
        Rank profile equivalent: <a href="schema-reference.html#num-search-partitions">num-search-partitions</a>
      </p>
      <p>
        Number of logical partitions the corpus on a content node is divided in.
        A partition is the smallest unit a search thread will handle.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matching<br/>.termwiseLimit</th>
    <td></td>
    <td>double [0.0, 1.0]</td>
    <td></td>
    <td>
      <p id="ranking.matching.termwiseLimit">
        Rank profile equivalent: <a href="schema-reference.html#termwise-limit">termwise-limit</a>
      </p>
      <p>
        If estimated number of hits > corpus * termwise-limit,
        document candidates are pruned with a
        <a href="../performance/feature-tuning.html#hybrid-taat-daat">TAAT</a> evaluation
        for query terms not needed for ranking.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matching<br/>.postFilterThreshold</th>
    <td></td>
    <td>double [0.0, 1.0]</td>
    <td></td>
    <td>
      <p id="ranking.matching.postFilterThreshold">
        Rank profile equivalent: <a href="schema-reference.html#post-filter-threshold">post-filter-threshold</a>
      </p>
      <p>
        Threshold value deciding if a query with an approximate
        <a href="query-language-reference.html#nearestneighbor">nearestNeighbor</a>
        operator combined with filters is evaluated using post-filtering.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matching<br/>.approximateThreshold</th>
    <td></td>
    <td>double [0.0, 1.0]</td>
    <td></td>
    <td>
      <p id="ranking.matching.approximateThreshold">
        Rank profile equivalent: <a href="schema-reference.html#approximate-threshold">approximate-threshold</a>
      </p>
      <p>
        Threshold value deciding if a query with an approximate
        <a href="query-language-reference.html#nearestneighbor">nearestNeighbor</a>
        operator combined with filters is evaluated by searching for approximate or exact nearest neighbors.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matching<br/>.targetHitsMaxAdjustmentFactor</th>
    <td></td>
    <td>double [1.0, inf]</td>
    <td></td>
    <td>
      <p id="ranking.matching.targetHitsMaxAdjustmentFactor">
        Rank profile equivalent: <a href="schema-reference.html#target-hits-max-adjustment-factor">target-hits-max-adjustment-factor</a>
      </p>
      <p>
        Value used to control the auto-adjustment of
        <a href="query-language-reference.html#targethits">targetHits</a> used when evaluating an approximate
        <a href="query-language-reference.html#nearestneighbor">nearestNeighbor</a>
        operator with post-filtering.
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="ranking.matchPhase">ranking.matchPhase</h2>
<p>
  Settings to control behavior during the match phase of query evaluation.
  If these are set in the query, they will override any
  <a href="schema-reference.html#match-phase">match-phase</a> settings in the rank profile.
  Detailed descriptions are found in the rank profile documentation.
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>ranking.matchPhase<br/>.attribute</th>
    <td></td>
    <td>string</td>
    <td></td>
    <td>
      <p id="ranking.matchphase.attribute">
        Rank profile equivalent: <a href="schema-reference.html#match-phase-attribute">match-phase: attribute</a>
      </p>
      <p>The attribute used to limit matches by if more than maxHits hits will be produced.</p>
    </td>
  </tr>
  <tr>
    <th>ranking.matchPhase<br/>.maxHits</th>
    <td></td>
    <td>long</td>
    <td></td>
    <td>
      <p id="ranking.matchphase.maxhits">
        Rank profile equivalent: <a href="schema-reference.html#match-phase-max-hits">match-phase: max-hits</a>
      </p>
      <p>The max number of hits that should be generated on each content node during the match phase.</p>
    </td>
  </tr>
  <tr>
    <th>ranking.matchPhase<br/>.ascending</th>
    <td></td>
    <td>boolean</td>
    <td></td>
    <td>
      <p id="ranking.matchphase.ascending">
        Rank profile equivalent: <a href="schema-reference.html#match-phase-order">match-phase: order</a>
      </p>
      <p>
        Whether to keep the documents having the highest (false) or lowest (true) values of the match phase attribute.
      </p>
    </td>
  </tr>
  <tr>
    <th>ranking.matchPhase<br/>.diversity.attribute</th>
    <td></td>
    <td>string</td>
    <td></td>
    <td>
      <p id="ranking.matchphase.diversity.attribute">
        Rank profile equivalent: <a href="schema-reference.html#diversity-attribute">diversity: attribute</a>
      </p>
      <p>The attribute to use when deciding diversity.</p>
    </td>
  </tr>
  <tr>
    <th>ranking.matchPhase<br/>.diversity.minGroups</th>
    <td></td>
    <td>long</td>
    <td></td>
    <td>
      <p id="ranking.matchphase.diversity.mingroups">
        Rank profile equivalent: <a href="schema-reference.html#diversity-min-groups">diversity: min-groups</a>
      </p>
      <p>
        The minimum number of groups that should be returned from the match phase grouped by the diversity attribute.
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="dispatch">Dispatch</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>dispatch.topKProbability</th>
    <td></td>
    <td>double</td>
    <td></td>
    <td>
      <p id="dispatch.topkprobability">
        Probability to use when computing how many hits to fetch from each partition
        when merging and creating the final result set.
        See <a href="services-content.html#top-k-probability">services</a> for details.
      </p>
      <p>
        Default: <a href="services-content.html#top-k-probability">none</a>.
        <!-- ToDo: Check this default, copied as-is, need some context -->
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="presentation">Presentation</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>presentation.bolding</th>
    <td>bolding</td>
    <td>Boolean</td>
    <td>true</td>
    <td>
      <p id="presentation.bolding">
        Whether or not to bold query terms in <a href="schema-reference.html">schema</a>
        fields defined with <a href="schema-reference.html#bolding">bolding: on</a>
        or <a href="schema-reference.html#summary">summary: dynamic</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>presentation.format</th>
    <td>format</td>
    <td>String</td>
    <td><code>default</code></td> <!-- ToDo: easier to understand if we just write json, which is the same? -->
    <td>
      <p id="presentation.format"></p>
      <table class="table">
        <thead>
        <tr>
          <th>Value</th>
          <th>Description</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td><em>No value</em> or <a href="default-result-format.html">default</a></td>
          <td>The default, builtin JSON format</td>
          <!-- ToDo: combine with below, and link to json format -->
        </tr>
        <tr>
          <td><a href="default-result-format.html">json</a></td>
          <td>Builtin JSON format</td>
        </tr>
        <tr>
          <td><code>xml</code></td>
          <td>
            Builtin XML format.
            {% include deprecated.html content="See <a href='../vespa8-release-notes.html'>deprecations</a>."%}
          </td>
        </tr>
        <tr>
          <td><a href="page-result-format.html">page</a></td>
          <td>
            XML format which is suitable for use with <a href="../page-templates.html">page templates</a>.
            {% include deprecated.html content="See <a href='../vespa8-release-notes.html'>deprecations</a>."%}
          </td>
        </tr>
        <tr>
          <td><em>Any other value</em></td>
          <td>A custom <a href="../result-rendering.html">result renderer</a> supplied by the application</td>
        </tr>
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>presentation.summary</th>
    <td>summary</td>
    <td>String</td>
    <td></td>
    <td>
      <p id="presentation.summary">
        The name of the <a href="../document-summaries.html">summary class</a>
        used to select fields in results.
      </p>
      <p>Default: The default summary class of the schema.</p><!-- ToDo: rewrite -->
    </td>
  </tr>
  <tr>
    <th>presentation.template</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="presentation.template">
        The id of a deployed page template to use for this result.
        This should be used with the <a href="page-result-format.html">page</a> result format.
      </p>
    </td>
  </tr>
  <tr>
    <th>presentation.timing</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="presentation.timing">
        Whether a result renderer should try to add optional timing information to the rendered page -
        see the <a href="default-result-format.html#timing">result reference</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>presentation.format.tensors</th>
    <td></td>
    <td>String</td>
    <td><code>short</code></td>
    <td>
      <p id="presentation.format.tensors">
        Controls how tensors are rendered in the result.
      </p>
      <table class="table">
        <thead>
        <tr>
          <th>Value</th>
          <th>Description</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td><code>short</code></td>
          <td>
            Render the tensor value in an object having two keys, "type" containing the value,
                  and "cells"/"blocks"/"values" (<a href="document-json-format.html#tensor">depending on the type</a>) containing the tensor content.<br/>
            Render the tensor content in the <a href="document-json-format.html#tensor">type-appropriate short form</a>.
          </td>
        </tr>
        <tr>
          <td><code>long</code></td>
          <td>
            Render the tensor value in an object having two keys, "type" containing the value,
            and "cells" containing the tensor content.<br/>
            Render the tensor content in the <a href="document-json-format.html#tensor">general verbose form</a>.
          </td>
        </tr>
        <tr>
          <td><code>short-value</code></td>
          <td>
            Render the tensor content directly.<br/>
            Render the tensor content in the <a href="document-json-format.html#tensor">type-appropriate short form</a>.
          </td>
        </tr>
        <tr>
          <td><code>long-value</code></td>
          <td>
            Render the tensor content directly.<br/>
            Render the tensor content in the <a href="document-json-format.html#tensor">general verbose form</a>.
          </td>
        </tr>
      </table>
  </tr>
  </tbody>
</table>



<h2 id="grouping-and-aggregation">Grouping and Aggregation</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>select</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="select">
        Requests specific multi-level result set statistics and/or hit groups to be returned in the result.
        Fields you want to retrieve statistics or hit groups for must be stored as document attributes
        in the index structure by adding attribute to the indexing statement.
      </p>
      <p>
        Default is no grouping.
      </p>
      <p>
        See the <a href="../grouping.html">grouping guide</a> for examples.
      </p>
    </td>
  </tr>
  <tr>
    <th>collapsefield</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="collapsefield">
        Comma-separated list of <a href="schema-reference.html#summary">field names</a>, that should only
        appear uniquely in a result. Hits with values in these fields which are already present in a higher-ranked
        hit will be filtered out.
      </p>
      <p>Read more in <a href="/en/result-diversity.html">result diversity</a> to compare this with other options.</p>
      <p>
        Default is no field collapsing.
      </p>
    </td>
  </tr>
  <tr>
    <th>collapsesize</th>
    <td></td>
    <td>Number</td>
    <td>1</td>
    <td>
      <p id="collapsesize">
        The number of hits to keep in each collapsed bucket - used for all collapsefields.
      </p>
    </td>
  </tr>
  <tr>
    <th>collapsesize.<em>fieldname</em></th>
    <td></td>
    <td>Number</td>
    <td>1</td>
    <td>
      <p id="collapsesize.fieldname">
        The number of hits to keep in each collapsed bucket - used for the specified field.
        This value takes precedence over the value specified in <code>collapsesize</code>.
      </p>
    </td>
  </tr>
  <tr>
    <th>collapse.summary</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="collapse.summary">
        A valid name of a document summary class.
        Use this summary class to fetch the fields used for collapsing.
      </p>
      <p>Default: Use default summary or attributes.</p>
    </td>
  </tr>
  <tr>
    <th>grouping.defaultMaxGroups</th>
    <td></td>
    <td>Number</td>
    <td>10</td>
    <td>
      <p id="grouping.defaultmaxgroups">
        Positive integer or <code>-1</code> to disable.
        <!-- ToDo: clarify what this means -->
      </p>
      <p>
        The default number of groups to return when
        <a href="../grouping.html#ordering-and-limiting-groups">max</a> is not specified.
      </p>
    </td>
  </tr>
  <tr>
    <th>grouping.defaultMaxHits</th>
    <td></td>
    <td>Number</td>
    <td>10</td>
    <td>
      <p id="grouping.defaultmaxhits">
        Positive integer or <code>-1</code> to disable.
        <!-- ToDo: clarify what this means -->
      </p>
      <p>
        The default number of hits to return when
        <a href="../grouping.html#hits-per-group">max</a> is not specified.
      </p>
    </td>
  </tr>
  <tr>
    <th>grouping.globalMaxGroups</th>
    <td></td>
    <td>Number</td>
    <td>10000</td>
    <td>
      <p id="grouping.globalmaxgroups">
        Positive integer or <code>-1</code> to disable.
        <!-- ToDo: clarify what this means -->
      </p>
      <p>
        A cost limit for grouping queries.
        Any query that may exceed this threshold will be preemptively failed by the container.
        The limit is defined as the total number of groups and document summaries a query may produce.
        A query that does not have an implicit or explicit <code>max</code> defined for all levels
        will always fail if limit is enabled.
        This parameter can only be overridden in a <a href="../query-profiles.html">query profile</a>.
      </p>
      <p>
        See the <a href="../grouping.html#global-limit">grouping guide</a> for practical examples.
      </p>
    </td>
  </tr>
  <tr>
    <th>grouping.defaultPrecisionFactor</th>
    <td></td>
    <td>Decimal<br/>number</td>
    <td>2.0</td>
    <td>
      <p id="grouping.defaultprecisionfactor">
        The default precision scale factor when
        <a href="../grouping.html#ordering-and-limiting-groups">precision</a> is not specified.
        The final precision value is calculated by multiplying the effective <code>max</code> value
        with the scale factor.
      </p>
    </td>
  </tr>
  </tbody>
</table>

<h2 id="streaming">Streaming</h2>
<p>
  Parameters for <a href="../streaming-search.html">streaming search mode</a>.
</p>

<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>streaming.groupname</th>
    <td></td>
    <td>A string</td>
    <td></td>
    <td>
      <p id="streaming.groupname">
        Sets the group (specified by <a href="../documents.html#id-scheme">g=&lt;groupname&gt;</a>) of the documents to stream through.
      </p>
    </td>
  </tr>
  <tr>
    <th>streaming.selection</th>
    <td></td>
    <td>A <a href="document-select-language.html">document selection</a></td>
    <td></td>
    <td>
      <p id="streaming.selection">
        Restricts streaming search using a selection expression instead of a group id.
      </p>
      <p>
        If the selection is on the form <code>id.group == "foo" or id.group == "bar" or id.group == ...</code>
        this will only stream documents in those groups, which is efficient for a small number of groups.
      </p>
      <p>
        If any other selection is used, this will stream through <i>all</i> groups, which is very costly.
      </p>
    </td>
  </tr>
  <tr>
    <th>streaming.maxbucketspervisitor</th>
    <td></td>
    <td>An integer
    <td>Positive infinity</td>
    <td>
      <p id="streaming.maxbucketspervisitor">
        If set, limit backend bucket concurrency to the specified number of buckets.
        Can be used to explicitly control resource usage for extremely large streaming search locations.
        This is an expert option.
      </p>
    </td>
  </tr>
  </tbody>
</table>


<h2 id="tracing">Tracing</h2>
<p>
  Parameters controlling trace information returning with the result for diagnostics.
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>trace.level</th>
    <td>tracelevel</td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="trace.level">
        A positive number. Default is no tracing.
      </p>
      <p>
        Collect trace information for debugging when running a query.
        Higher numbers give progressively more detail on query transformations,
        searcher execution and content node(s) query execution.
        See <a href="../query-api.html#query-tracing">query tracing</a> for details and examples.
      </p> <!-- ToDo: Add links, rewrite -->
      <p>
        Tracing is subject to change at any time, the below is a guide:
      </p>
      <table class="table">
        <thead>
        <tr><th>Level</th><th>Description</th></tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>Basic tracing in container</td></tr>
        <tr><td>2</td><td>Basic tracing, more details</td></tr>
        <tr><td>3</td><td>Basic tracing, even more details</td></tr>
        <tr><td>4</td><td>Include timing info from content nodes</td></tr>
        <tr><td>5</td><td>Even more timing info from content nodes</td></tr>
        <tr><td>6</td><td>Include the query execution plan (blueprint)</td></tr>
        <tr><td>7</td><td>Include the query execution tree</td></tr>
        </tbody>
      </table>
    </td>
  </tr>
  <tr>
    <th>trace.explainLevel</th>
    <td>explainlevel</td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="trace.explainlevel">
        Set to a positive number to collect query execution information for debugging when running a query.
        Higher numbers give progressively more detail on content node query execution. Tuning this parameter
        is useful if we want to get more information from the content nodes without gathering lots of trace information from the container chain.
      </p>
      <p>Explanation is subject to change at any time, the below is a guide:</p>
      <table class="table">
        <thead>
        <tr><th>Level</th><th>Description</th></tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>Timing and overall query plan (blueprint) from each content node</td></tr>
        <tr><td>2</td><td>Timing per search thread and execution tree (search iterator tree)</td></tr>
        </tbody>
      </table>
      <p>
        Note that you might get the same at <a href="#trace.level">trace.level</a> 5 and above.
        Default is no explanation.
      </p>
      <p>Tracing with <code>trace.explainLevel</code> also requires that <a href="#trace.level">trace.level</a> is positive.</p>
    </td>
  </tr>
  <tr>
    <th>trace.profileDepth</th>
    <td></td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="trace.profiledepth">
        Turns on performance profiling of the content node query execution for
        <a href="#trace.profiling.matching.depth">matching</a>,
        <a href="#trace.profiling.firstPhaseRanking.depth">first-phase ranking</a>, and
        <a href="#trace.profiling.secondPhaseRanking.depth">second-phase ranking</a>.
        How profiling is performed is based on whether <code>trace.profileDepth</code> is positive or negative:
      </p>
      <table class="table">
        <thead>
        <tr><th>Type</th><th>Description</th></tr>
        </thead>
        <tbody>
        <tr><td>Tree</td>
        <td>A positive number specifies the depth used by a tree profiler.
        A higher number means more profiler data.
        The output resembles the structure of the search iterator tree or rank expression tree being profiled,
        with total time and self time tracked per component (node in the tree).
        </td></tr>
        <tr><td>Flat</td><td>A negative number specifies the topn (cut-off) used by a flat profiler.
        The output returns the topn components that use the most self time.
        </td></tr>
        </tbody>
      </table>
      <p>
        The performance profiling output is subject to change at any time.
        Default is no information.
      </p>
      <p>Tracing with <code>trace.profileDepth</code> also requires that <a href="#trace.level">trace.level</a> is positive.</p>
    </td>
  </tr>

  <tr>
    <th>trace.profiling.matching.depth</th>
    <td></td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="trace.profiling.matching.depth">
        Turns on profiling of
        <a href="../performance/sizing-search.html#life-of-a-query-in-vespa">matching</a>
        of the content node query execution.
        This exposes information about how time spent on matching is distributed
        between individual search iterators.
        The profiling output is tagged <em>match_profiling</em> and is subject to change at any time.
        Default is no information.
        See <a href="#trace.profiledepth">trace.profileDepth</a> for semantics of this parameter.
      </p>
      <p>Tracing with <code>trace.profiling.matching.depth</code> requires that <a href="#trace.level">trace.level</a> is positive.</p>
    </td>
  </tr>

  <tr>
    <th>trace.profiling.firstPhaseRanking.depth</th>
    <td></td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="trace.profiling.firstPhaseRanking.depth">
        Turns on profiling of the <a href="../ranking.html">first-phase ranking</a>
        of the content node query execution.
        This exposes information about how time spent on first-phase ranking is distributed
        between individual <a href="rank-features.html">rank features</a>.
        The profiling output is tagged <em>first_phase_profiling</em> and is subject to change at any time.
        Default is no information.
        See <a href="#trace.profiledepth">trace.profileDepth</a> for semantics of this parameter.
      </p>
      <p>Tracing with <code>trace.profiling.firstPhaseRanking.depth</code> also requires that <a href="#trace.level">trace.level</a> is positive.</p>
    </td>
  </tr>

  <tr>
    <th>trace.profiling.secondPhaseRanking.depth</th>
    <td></td>
    <td>Number</td>
    <td>0</td>
    <td>
      <p id="trace.profiling.secondPhaseRanking.depth">
        Turns on profiling of the <a href="../ranking.html">second-phase ranking</a>
        of the content node query execution.
        This exposes information about how time spent on second-phase ranking is distributed
        between individual <a href="rank-features.html">rank features</a>.
        The profiling output is tagged <em>second_phase_profiling</em> and is subject to change at any time.
        Default is no information.
        See <a href="#trace.profiledepth">trace.profileDepth</a> for semantics of this parameter.
      </p>
      <p>Tracing with <code>trace.profiling.secondhaseRanking.depth</code> also requires that <a href="#trace.level">trace.level</a> is positive.</p>
    </td>
  </tr>

  <tr>
    <th>trace.timestamps</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="trace.timestamps">
        Enable to get timing information already at <a href="#trace.level">trace.level=1</a>.
        This is useful for debugging latency spent at different components in the container search chain
        without rendering a lot of string data which is associated with higher trace levels.
      </p>
    </td>
  </tr>
  <tr>
    <th>trace.query</th>
    <td></td>
    <td>Boolean</td>
    <td>true</td>
    <td>
      <p id="trace.query">
        Whether to include the query in any trace messages.
        This is useful for avoiding query serialization with very large queries
        to avoid impact from it on performance and excessively large traces.
      </p>
    </td>
  </tr>
  </tbody>
</table>



<h2 id="semantic-rules">Semantic Rules</h2>
<p>
Refer to <a href="semantic-rules.html">semantic rules</a>.
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>rules.off</th>
    <td></td>
    <td>Boolean</td>
    <td>true</td>
    <td>
      <p id="rules.off">Turn rule evaluation off for this query.</p>
    </td>
  </tr>
  <tr>
    <th>rules.rulebase</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="rules.rulebase">A rule base name - the name of the rule base to use for these queries.</p>
    </td>
  </tr>
  <tr>
    <th>tracelevel.rules</th>
    <td></td>
    <td>Number</td>
    <td></td>
    <td>
      <p id="tracelevel.rules">
        The amount of rule evaluation trace output to show, higher number means more details.
        This is useful to see a trace from rule evaluation
        without having to see trace from all other searchers at the same time.
      </p>
      <!-- ToDo: something about the default, which is probably no trace -->
    </td>
  </tr>
  </tbody>
</table>



<h2 id="other">Other</h2>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>recall</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="recall">
        Any allowed collection of recall terms.
        Sets a recall parameter to be combined with the query.
        This is identical to <a href="#model.filter">filter</a>,
        except that recall terms are not exposed to the ranking framework and thus not ranked.
        As such, one can not use unprefixed terms; they must either be positive or negative.
      </p>
    </td>
  </tr>
  <tr>
    <th>user</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="user">
        The id of the user making the query.
        The content of the argument is made available to the search chain,
        but it triggers no features in Vespa apart from being propagated to the access log.
      </p>
      <!-- ToDo: Remove in Vespa 9 or before -->
    </td>
  </tr>
  <tr>
    <th>hitcountestimate</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="hitcountestimate">
        Make this an estimation query.
        No hits will be returned,
        and total hit count will be set to an estimate of what executing the query as a normal query would give.
      </p>
    </td>
  </tr>
  <tr>
    <th>metrics.ignore</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="metrics.ignore">
        Ignore metric collection for this query request,
        useful for <a href="../performance/container-tuning.html#container-warmup">warm-up queries</a>.
      </p>
    </td>
  </tr>
  <tr>
    <th>weakAnd.replace</th>
    <td></td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="weakand.replace">
        Replace all instances of OR in the query tree with weakAnd.
      </p>
      <!-- ToDo: add links to/from -->
    </td>
  </tr>
  <tr>
    <th>wand.hits</th>
    <td></td>
    <td>Number</td>
    <td>100</td>
    <td>
      <p id="wand.hits">
        Used in combination with <a href="#weakand.replace">weakAnd.replace</a>.
        Sets the targetHits of the new weakAnds to the specified value.
      </p>
      <!-- ToDo: link to targethits -->
    </td>
  </tr>
  <tr>
    <th>sorting.degrading</th>
    <td></td>
    <td>Boolean</td>
    <td>true</td>
    <td>
      <p id="sorting.degrading">
        When sorting on a <a href="../attributes.html">single-value numeric attribute with fast-search</a>
        an optimization is activated to return early, with an inaccurate total-hits count.
        Set <code>sorting.degrading</code> to false to disable this optimization.
      </p>
      <p>
        This optimization sets the primary sorting attribute as the
        <a href="#ranking.matchphase.attribute">match phase attribute</a>, and
        <a href="#ranking.matchphase.maxhits">match phase maxHits</a> equal to
        <code>max(10000, maxHits+maxOffset)</code>.
        <a href="#hits">maxHits</a> and
        <a href="#offset">maxOffset</a> can be set in a query profile.
      </p>
    </td>
  </tr>
  <tr>
    <th>noCache</th>
    <td>nocache</td>
    <td>Boolean</td>
    <td>false</td>
    <td>
      <p id="nocache">
        Sets whether this query should never be served from a cache.
        Vespa has <a href="../performance/caches-in-vespa.html">few caches</a>,
        and this parameter does not control any of them.
        Therefore, this parameter has no effect
      </p>
      <!-- ToDo: Remove in Vespa 9 or before -->
    </td>
  </tr>
  </tbody>
</table>



<h2 id="http-status-codes">HTTP status codes</h2>
<p>The status code rules are:</p>
<ul>
  <li>
    If the Result contains no errors (Result.hits().getError()==null): 200 OK is returned.
  </li>
  <li>
    If the Result contains errors and no regular hits:
    <ul>
      <li>
        If the error code of any ErrorMessage in the Result
        (Result.hits().getErrorHit().errorIterator()) is a "WEB SERVICE ERROR CODE",
        the first of those is returned.
      </li>
      <li>
        Otherwise, if it is an "HTTP COMPATIBLE ERROR CODE", the mapping of it is returned.
      </li>
      <li>
        Otherwise 500 INTERNAL_SERVER_ERROR is returned.
      </li>
    </ul>
  </li>
  <li>
    If the Result contains errors and also contains valid hits:
    The same as above, but 200 OK is returned by default instead of 500.
  </li>
</ul>
<p>WEB SERVICE ERROR CODES:</p>
<pre>
200, 301, 302, 307, 400, 401, 403, 404, 405, 406, 408, 428, 429, 431, 500, 501, 502, 511
</pre>
<p>HTTP COMPATIBLE ERROR CODES:</p>
<pre>
com.yahoo.container.protect.Error.BAD_REQUEST -&gt; Http code 400
com.yahoo.container.protect.Error.UNAUTHORIZED -&gt; Http code 401
com.yahoo.container.protect.Error.FORBIDDEN -&gt; Http code 403
com.yahoo.container.protect.Error.NOT_FOUND -&gt; Http code 404
com.yahoo.container.protect.Error.INTERNAL_SERVER_ERROR -&gt; Http code 500
com.yahoo.container.protect.Error.INSUFFICIENT_STORAGE -&gt; Http code 507
</pre>


<hr/>

<!-- ToDo: Consider deprecating for Vespa 9 -->
<h2 id="select.json">select</h2>
<p>
  A <code>select</code> query is equivalent in structure to YQL, written in JSON.
  Contains subparameters <code>where</code> and <code>grouping</code>.
</p>
<table class="table">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Alias</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  </thead>
  <tbody>
  <tr>
    <th>where</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="select.where">
        A string with JSON.
        Refer to the <a href="select-reference.html">select reference</a> for details.
      </p>
    </td>
  </tr>
  <tr>
    <th>grouping</th>
    <td></td>
    <td>String</td>
    <td></td>
    <td>
      <p id="select.grouping">
        A string with JSON.
        Refer to the <a href="select-reference.html">select reference</a> for details.
      </p>
    </td>
  </tr>
  </tbody>
</table>
