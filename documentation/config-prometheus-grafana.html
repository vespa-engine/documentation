---
# Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "Setting up monitoring with Prometheus and Grafana for Cloud Vespa"
---

<p>
This guide describes how to set up monitoring with Prometheus and Grafana for Vespa Cloud.
This guide assumes access to a Cloud Vespa instance, as well as a Prometheus and Grafana instance.
It is recommended to use Grafana Cloud, but any Grafana instance that is capable of reaching the Prometheus
instance should be sufficient for the task.
</p>

<strong>Prerequisites</strong>:
<ul>
  <li>A Vespa instance
  <li>A Grafana instance
  <li>A Prometheus instance
</ul>

<h2> Configuring Prometheus:</h2>
<p>
Prometheus is configured using <em>prometheus.yml</em>. Download it from the
<a href="https://github.com/vespa-engine/sample-apps/tree/master/album-recommendation-monitoring/prometheus"> prometheus
</a> folder.
This file is based upon the sample-apps repository, but is easy to adjust.
To get started, the target has to be changed from the current vespa:19092 to <strong>your Vespa instance endpoint</strong>.
If theservice is on Cloud Vespa, go to the application an click endpoints and copy the endpoint.
If the service is hosted elsewhere, retrieve the endpoint appropriate to that hosting solution.
Then just replace the vespa:19092 with the endpoint.
Restart the Prometheus instance and the data from Vespa should start appearing.
If the Prometheus instance is used for multiple services, simply append the target configuration for Vespa at the end of the document.
</p>

<h2>Configuring Grafana Dashboard:</h2>
<p>
It is possible to configure Grafana both through the GUI or through configuration files.
This guide covers how to configure Grafana using the configuration files and also gives a default dashboard.
</p><p>
To start configuring Grafana, download the
<a href="https://github.com/vespa-engine/sample-apps/tree/master/album-recommendation-monitoring/grafana/provisioning">
provisioning folder</a> from sample-apps.
This will serve as a baseline for further configuration.
</p><p>
In the provisioning folder there are a few different files that all help for configuring Grafana locally.
These work as good examples of default configurations, but the most important is the file named Vespa-Metrics-Dashboard.json.
This is a default dashboard that will be used for setting up Grafana.
</p><p>
Click the + button on the side and go to import. Upload the file to the Grafana instance.
This should automatically load in the dashboard for usage.
For now it will not display any data as we have not yet configured data sources.
</p>

<h2>Configuring Grafana Datasource:</h2>
<p>
The Prometheus datasource has to be added to the Grafana instance for the visualisation to work.
Click the cog on the left and then "Data Sources".
Click "Add data source" and choose Prometheus from the list.
Add the URL for the Prometheus instance with appropriate bindings for connecting.
The configuration for the bindings will depend on how your Prometheus instance is hosted.
Once the configuration details have been entered, click Save &amp; Test at the bottom and ensure that Grafana says "Data source is working".
</p>

<h2> Verifying Data Flow:</h2>
Navigate back to the Vespa Metrics dashboard by clicking the dashboard symbol on the left (4 blocks) and clicking manage and then click Vespa Metrics.
Data should now be appearing in the Grafana dashboard.
If there is no data appearing, it either means that the Vespa instance is not being utilized or that some part of the configuration is wrong.
<p>

</p>
